<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SawangHos IPD Nurse Workbench</title>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/17084/17084972.png" type="image/png">
  
  <script src="https://cdn.tailwindcss.com"></script>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    /* ตั้งค่า Font หลัก */
    body {
      font-family: 'Sarabun', sans-serif;
    }
    /* คลาสสำหรับซ่อน/แสดง */
    .hidden {
      display: none;
    }
  </style>
</head>

<body class="bg-gray-100">

  <nav class="bg-white shadow-md fixed top-0 left-0 right-0 z-40">
    <div class="container mx-auto px-4 py-3">
      <div class="flex justify-between items-center">
        <div class="flex items-center space-x-3">
          <img src="https://swdcph.moph.go.th/intranet/login/images/logo_swd.png" alt="Logo" class="h-12 w-12">
          <div>
            <h1 class="text-xl font-bold text-gray-800">IPD Nurse Workbench</h1>
            <div id="realtime-clock" class="text-xs text-gray-500"></div>
          </div>
        </div>
        
        <div class="md:hidden">
        </div>
      </div>
    </div>
  </nav>

  <!-- (สำคัญ!) แท็ก <main> จะคลุมทุกอย่างไว้ -->
  <main class="mt-24 pt-4 container mx-auto px-4">

    <!-- (1) หน้าเลือก Ward -->
    <section id="ward-selection" class="animate-fade-in">
      <h2 class="text-2xl font-semibold text-gray-700 mb-6 text-center">ระบบบันทึกเวชระเบียนทางการพยาบาล งานการพยาบาลผู้ป่วยใน</h2>
      <div id="ward-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
      </div>
    </section>

    <!-- (2) หน้าทะเบียนผู้ป่วย -->
    <section id="registry-page" class="hidden animate-fade-in">
      
      <div class="bg-white p-4 rounded-lg shadow mb-6">
        <div class="flex flex-col md:flex-row justify-between md:items-center gap-4">
          <div>
            <h2 class="text-2xl font-bold text-blue-700" id="ward-header-title"></h2>
            <select id="ward-switcher" class="mt-1 p-2 border rounded-md">
            </select>
          </div>
          
          <div>
            <button id="open-admit-modal-btn" class="w-full md:w-auto bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg shadow transition-colors">
              + Admit ผู้ป่วยใหม่
            </button>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-3 mt-4 border-t pt-4">
          <input type="text" id="search-hn" placeholder="ค้นหา HN" class="p-2 border rounded-md">
          <input type="text" id="search-an" placeholder="ค้นหา AN" class="p-2 border rounded-md">
          <input type="text" id="search-name" placeholder="ค้นหา ชื่อ-สกุล" class="p-2 border rounded-md">
          <input type="text" id="search-doctor" placeholder="ค้นหา แพทย์" class="p-2 border rounded-md">
        </div>
      </div>

      <div class="bg-white rounded-lg shadow overflow-x-auto">
        <table class="w-full min-w-max">
          <thead class="bg-gray-200 text-gray-700">
            <tr>
              <th class="p-3 text-left">เวชระเบียน</th>
              <th class="p-3 text-left">เตียง</th>
              <th class="p-3 text-left">HN</th>
              <th class="p-3 text-left">AN</th>
              <th class="p-3 text-left">ชื่อ-สกุล ผู้ป่วย</th>
              <th class="p-3 text-left">อายุ (ปี/ด/ว)</th>
              <th class="p-3 text-left">แผนก</th>
              <th class="p-3 text-left">แพทย์</th>
              <th class="p-3 text-left">วันที่ Admit</th>
              <th class="p-3 text-left">วันนอน (LOS)</th>
              </tr>
          </thead>
          <tbody id="patient-table-body" class="divide-y divide-gray-200">
          </tbody>
        </table>
      </div>
    </section>

    <!-- (3) หน้า Chart (เวชระเบียน) -->
    <section id="chart-page" class="hidden animate-fade-in">
  
      <div class="bg-white p-4 rounded-lg shadow mb-6 flex justify-between items-center">
        <div>
          <h2 class="text-2xl font-bold text-indigo-700">เวชระเบียนผู้ป่วยงานการพยาบาลผู้ป่วยใน (Patient Chart)</h2>
          <p class="text-gray-600">
            เตียง: <strong id="chart-bed-display" class="text-indigo-700"></strong> | 
            AN: <strong id="chart-an-display"></strong> | 
            HN: <strong id="chart-hn-display"></strong> | 
            ชื่อ: <strong id="chart-name-display"></strong> | 
            แพทย์: <strong id="chart-doctor-display" class="text-indigo-700"></strong>
          </p>
        </div>
        <button id="close-chart-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg">
          &larr; กลับหน้าทะเบียน
        </button>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <!-- (3.1) เมนูฟอร์ม (ซ้าย) -->
        <div class="lg:col-span-1">
          <div class="bg-white rounded-lg shadow overflow-hidden">
            <ul class="divide-y divide-gray-200">
              
              <li class="p-4 hover:bg-gray-50 flex justify-between items-center cursor-pointer chart-list-item" data-form="classify">
                <div>
                  <h3 class="text-lg font-semibold text-gray-900">แบบบันทึกการการจำแนกประเภทผู้ป่วย</h3>
                  <p class="text-sm text-gray-500">บันทึกรายเวร</p>
                </div>
                <div class="text-right">
                  <span class="text-sm text-gray-600">อัปเดต: <span id="last-updated-classify">ยังไม่เคยบันทึก</span></span>
                  <span class="text-blue-600 font-semibold ml-4">&gt;</span>
                </div>
              </li>

              <li class="p-4 hover:bg-gray-50 flex justify-between items-center cursor-pointer chart-list-item" data-form="morse_maas">
                <div>
                  <h3 class="text-lg font-semibold text-gray-900">แบบประเมินความเสี่ยง Morse / MAAS</h3>
                  <p class="text-sm text-gray-500">Morse Fall Scale & MAAS</p>
                </div>
                <div class="text-right">
                  <span class="text-sm text-gray-600">สถานะ: <span id="last-updated-morse">คลิกเพื่อโหลด</span></span>
                  <span class="text-blue-600 font-semibold ml-4">&gt;</span>
                </div>
              </li>

              <li class="p-4 hover:bg-gray-50 flex justify-between items-center cursor-pointer chart-list-item" data-form="braden">
                <div>
                  <h3 class="text-lg font-semibold text-gray-900">แบบประเมินแผลกดทับ (Braden)</h3>
                  <p class="text-sm text-gray-500">Braden Scale</p>
                </div>
                <div class="text-right">
                  <span class="text-sm text-gray-600">สถานะ: <span id="last-updated-braden">คลิกเพื่อโหลด</span></span>
                  <span class="text-blue-600 font-semibold ml-4">&gt;</span>
                </div>
              </li>  
              
              <li class="p-4 hover:bg-gray-50 flex justify-between items-center cursor-pointer chart-list-item" data-form="004">
                <div>
                  <h3 class="text-lg font-semibold text-gray-900">แบบประเมินประวัติและสมรรถนะผู้ป่วยฯ</h3>
                  <p class="text-sm text-gray-500">FR-IPD-004</p>
                </div>
                <div class="text-right">
                  <span class="text-sm text-gray-600">อัปเดต: <span id="last-updated-004">ยังไม่เคยบันทึก</span></span>
                  <span class="text-blue-600 font-semibold ml-4">&gt;</span>
                </div>
              </li>

              <li class="p-4 hover:bg-gray-50 flex justify-between items-center cursor-pointer chart-list-item" data-form="advice">
                <div>
                  <h3 class="text-lg font-semibold text-gray-900">การให้คำแนะนำการปฏิบัติตัวผู้ป่วย (Discharge Plan)</h3>
                  <p class="text-sm text-gray-500">Advice for Patient</p>
                </div>
                <div class="text-right">
                  <span class="text-sm text-gray-600">สถานะ: <span id="last-updated-advice">คลิกเพื่อโหลด</span></span>
                  <span class="text-blue-600 font-semibold ml-4">&gt;</span>
                </div>
              </li>

              <li class="p-4 hover:bg-gray-50 flex justify-between items-center cursor-pointer chart-list-item" data-form="005">
                <div>
                  <h3 class="text-lg font-semibold text-gray-900">รายการปัญหาสุขภาพ (FOCUS LIST)</h3>
                  <p class="text-sm text-gray-500">FR-IPD-005</p>
                </div>
                <div class="text-right">
                  <span class="text-sm text-gray-600">อัปเดต: <span id="last-updated-005">ยังไม่เคยบันทึก</span></span>
                  <span class="text-blue-600 font-semibold ml-4">&gt;</span>
                </div>
              </li>

              <li class="p-4 hover:bg-gray-50 flex justify-between items-center cursor-pointer chart-list-item" data-form="006">
                <div>
                  <h3 class="text-lg font-semibold text-gray-900">บันทึกความก้าวหน้าทางการพยาบาล</h3>
                  <p class="text-sm text-gray-500">Nursing Progress Note (FR-IPD-006)</p>
                </div>
                <div class="text-right">
                  <span class="text-sm text-gray-600">อัปเดต: <span id="last-updated-006">คลิกเพื่อโหลด</span></span>
                  <span class="text-blue-600 font-semibold ml-4">&gt;</span>
                </div>
              </li>

              <li class="p-4 hover:bg-gray-50 flex justify-between items-center cursor-pointer chart-list-item" data-form="007">
                <div>
                  <h3 class="text-lg font-semibold text-gray-900">แบบบันทึกการพยาบาลผู้ป่วยจำหน่าย</h3>
                  <p class="text-sm text-gray-500">PR-IPD-007</p>
                </div>
                <div class="text-right">
                  <span class="text-sm text-gray-600">สถานะ: <span id="last-updated-007">คลิกเพื่อโหลด</span></span>
                  <span class="text-blue-600 font-semibold ml-4">&gt;</span>
                </div>
              </li>
            </ul>
          </div>
        </div>
        
        <!-- (3.2) หน้าพรีวิว (ขวา) -->
        <div class="lg:col-span-2">
          <div class="bg-white rounded-lg shadow sticky top-24"> 
            <div class="p-4 border-b flex justify-between items-center">
              <h3 id="chart-preview-title" class="text-xl font-semibold text-indigo-700">เลือกเอกสาร</h3>
              <div>
                <button id="chart-add-new-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg mr-2 hidden">
                  + เพิ่มใหม่
                </button>
                <button id="chart-edit-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hidden">
                   แก้ไข
                </button>
              </div>
            </div>
            
            <div id="chart-preview-wrapper" class="overflow-y-auto" style="max-height: 75vh;">
              <!-- (Placeholder เริ่มต้น) -->
              <div id="chart-preview-placeholder" class="text-center text-gray-500 py-20 px-6">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                  <path vector-effect="non-scaling-stroke" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <h3 class="mt-2 text-lg font-semibold text-gray-700">กรุณาเลือกรายการเอกสาร</h3>
                <p class="mt-1 text-sm text-gray-500">คลิกรายการด้านซ้ายเพื่อดูตัวอย่าง (Read-only) หรือกด "แก้ไข"</p>
              </div>
              
              <!-- (เนื้อหาพรีวิวจะถูกฉีดมาที่นี่) -->
              <div id="chart-preview-content" class="p-6"></div>
            </div>
          </div>
        </div>
        
      </div>
    </section> <!-- (ปิด section 'chart-page') -->

    <!-- ============================================= -->
    <!-- (4) TEMPLATES (สำหรับ Clone) -->
    <!-- ============================================= -->

    <!-- (Template 004) -->
    <template id="preview-template-004">
      <div class="space-y-6">
        <style>
          .preview-grid { display: grid; grid-template-columns: repeat(1, 1fr); gap: 1rem; }
          @media (min-width: 768px) { .preview-grid { grid-template-columns: repeat(3, 1fr); } }
          .preview-grid dt { font-size: 0.875rem; font-weight: 600; color: #4B5563; }
          .preview-grid dd { font-size: 1rem; color: #1F2937; min-height: 1.5rem; border-bottom: 1px dashed #D1D5DB; padding-bottom: 2px; }
          .preview-grid .col-span-full { grid-column: 1 / -1; }
          .preview-grid-2 { grid-template-columns: repeat(2, 1fr); }
          .preview-grid-4 { grid-template-columns: repeat(4, 1fr); }
        </style>
        <!-- (เนื้อหา Fieldset ทั้งหมดของ 004...) -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">ข้อมูลทั่วไป</legend>
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-2 preview-grid">
            <div><dt>วันที่รับ:</dt><dd data-field="AdmitDate"></dd></div>
            <div><dt>เวลารับ:</dt><dd data-field="AdmitTime"></dd></div>
            <div><dt>รับจาก:</dt><dd data-field="AdmittedFrom"></dd></div>
            <div><dt>Refer จาก:</dt><dd data-field="Refer"></dd></div>
            <div><dt>มาโดย:</dt><dd data-field="ArriveBy"></dd></div>
            <div><dt>ผู้ให้ข้อมูล:</dt><dd data-field="InfoSource"></dd></div>
            <div class="md:col-span-2"><dt>ผู้ดูแลหลัก:</dt><dd data-field="MainCaregiver_Name"></dd></div>
            <div class="md:col-span-2"><dt>ความสัมพันธ์:</dt><dd data-field="MainCaregiver_Rel"></dd></div>
            <div class="col-span-full"><dt>อาการสำคัญ (CC):</dt><dd data-field="ChiefComplaint"></dd></div>
            <div class="col-span-full"><dt>ประวัติปัจจุบัน (PI):</dt><dd data-field="PresentIllness"></dd></div>
            <div class="col-span-full"><dt>อาการแรกรับ:</dt><dd data-field="AdmitSymptoms"></dd></div>
            <div><dt>BT:</dt><dd data-field="Admit_BT"></dd></div>
            <div><dt>PR:</dt><dd data-field="Admit_PR"></dd></div>
            <div><dt>RR:</dt><dd data-field="Admit_RR"></dd></div>
            <div><dt>BP:</dt><dd data-field="Admit_BP"></dd></div>
          </div>
        </fieldset>
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">ประวัติการเจ็บป่วย (History)</legend>
          <div class="preview-grid mt-2">
            <div><dt>โรคประจำตัว:</dt><dd data-field="Hx_Status"></dd></div>
            <div class="col-span-full"><dt>รายละเอียดโรค:</dt><dd id="preview-hx-details"></dd></div>
            <div><dt>การแพ้ยา:</dt><dd data-field="Allergy_Status"></dd></div>
            <div class="col-span-full"><dt>รายละเอียดการแพ้:</dt><dd data-field="Allergy_Details"></dd></div>
            <div><dt>การผ่าตัด:</dt><dd data-field="Sx_Status"></dd></div>
            <div class="md:col-span-2"><dt>รายละเอียดผ่าตัด:</dt><dd id="preview-sx-details"></dd></div>
            <div><dt>การนอน รพ.:</dt><dd data-field="AdmitHx_Status"></dd></div>
            <div class="md:col-span-2"><dt>รายละเอียดการนอน รพ.:</dt><dd id="preview-admit-hx-details"></dd></div>
            <div><dt>ประวัติครอบครัว:</dt><dd data-field="FamilyHx_Status"></dd></div>
            <div class="md:col-span-2"><dt>รายละเอียดประวัติครอบครัว:</dt><dd data-field="FamilyHx_Details"></dd></div>
            <div><dt>สุรา:</dt><dd data-field="Substance_Alcohol"></dd></div>
            <div class="md:col-span-2"><dt>ปริมาณสุรา:</dt><dd data-field="Substance_Alcohol_Vol"></dd></div>
            <div><dt>บุหรี่:</dt><dd data-field="Substance_Smoke"></dd></div>
            <div class="md:col-span-2"><dt>ปริมาณบุหรี่:</dt><dd data-field="Substance_Smoke_Vol"></dd></div>
            <div><dt>ยาที่ใช้ประจำ:</dt><dd data-field="Meds_Status"></dd></div>
            <div class="col-span-full"><dt>รายละเอียดยา:</dt><dd data-field="Meds_Details"></dd></div>
          </div>
        </fieldset>
        
        <!-- 1. การรับรู้สุขภาพ -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">1. การรับรู้สุขภาพ</legend>
          <div class="preview-grid mt-2">
            <div><dt>ก่อนป่วย:</dt><dd data-field="HP_Before"></dd></div>
            <div class="md:col-span-2"><dt>รายละเอียด (ก่อนป่วย):</dt><dd data-field="HP_Before_Detail"></dd></div>
            <div><dt>ครั้งนี้:</dt><dd data-field="HP_Current"></dd></div>
            <div><dt>การดูแล:</dt><dd data-field="HP_Care"></dd></div>
            <div class="md:col-span-2"><dt>ดูแล (อื่นๆ):</dt><dd data-field="HP_Care_Other"></dd></div>
            <div class="col-span-full"><dt>ความคาดหวัง:</dt><dd data-field="HP_Expect"></dd></div>
          </div>
        </fieldset>

        <!-- 2. โภชนาการ -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">2. โภชนาการ</legend>
          <div class="preview-grid mt-2">
            <div><dt>รับประทาน:</dt><dd data-field="Nutri_Meals"></dd></div>
            <div><dt>ประเภทอาหาร:</dt><dd data-field="Nutri_Type"></dd></div>
            <div><dt>อาหารเฉพาะโรค:</dt><dd data-field="Nutri_Type_Detail"></dd></div>
            <div><dt>ปัญหาการกิน:</dt><dd data-field="Nutri_Problem"></dd></div>
            <div><dt>ผิวหนัง:</dt><dd data-field="Nutri_Skin"></dd></div>
            <div class="md:col-span-2"><dt>ผิวหนัง (ระบุ):</dt><dd data-field="Nutri_Skin_Detail"></dd></div>
          </div>
        </fieldset>

        <!-- 3. การขับถ่าย -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">3. การขับถ่าย</legend>
          <div class="preview-grid mt-2">
            <div><dt>ปัสสาวะ (ครั้ง/วัน):</dt><dd data-field="Elim_Urine_Freq"></dd></div>
            <div><dt>สถานะปัสสาวะ:</dt><dd data-field="Elim_Urine_Status"></dd></div>
            <div><dt>ปัสสาวะ (ระบุ):</dt><dd data-field="Elim_Urine_Detail"></dd></div>
            <div><dt>อุจจาระ (ครั้ง/วัน):</dt><dd data-field="Elim_Bowel_Freq"></dd></div>
            <div><dt>สถานะอุจจาระ:</dt><dd data-field="Elim_Bowel_Status"></dd></div>
            <div><dt>อุจจาระ (ระบุ):</dt><dd data-field="Elim_Bowel_Detail"></dd></div>
            <div class="col-span-full"><dt>ขับถ่ายทางหน้าท้อง:</dt><dd data-field="Elim_Stoma"></dd></div>
          </div>
        </fieldset>

        <!-- 4. ADL -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">4. กิจวัตรประจำวัน (ADL)</legend>
          <div class="overflow-x-auto mt-2">
            <table class="w-full text-sm">
              <thead class="bg-gray-50">
                <tr class="text-left">
                  <th class="p-2 border">กิจกรรม</th>
                  <th class="p-2 border">ก่อนการเจ็บป่วย</th>
                  <th class="p-2 border">ขณะเจ็บป่วย</th>
                </tr>
              </thead>
              <tbody>
                <tr><td class="p-2 border">การรับประทานอาหาร</td><td class="p-2 border"><dd data-field="ADL_Eat_Before"></dd></td><td class="p-2 border"><dd data-field="ADL_Eat_Current"></dd></td></tr>
                <tr><td class="p-2 border">การทำความสะอาดปาก/ฟัน</td><td class="p-2 border"><dd data-field="ADL_Brush_Before"></dd></td><td class="p-2 border"><dd data-field="ADL_Brush_Current"></dd></td></tr>
                <tr><td class="p-2 border">การแต่งตัว</td><td class="p-2 border"><dd data-field="ADL_Dress_Before"></dd></td><td class="p-2 border"><dd data-field="ADL_Dress_Current"></dd></td></tr>
                <tr><td class="p-2 border">การเดิน</td><td class="p-2 border"><dd data-field="ADL_Walk_Before"></dd></td><td class="p-2 border"><dd data-field="ADL_Walk_Current"></dd></td></tr>
                <tr><td class="p-2 border">การขับถ่าย</td><td class="p-2 border"><dd data-field="ADL_Toilet_Before"></dd></td><td class="p-2 border"><dd data-field="ADL_Toilet_Current"></dd></td></tr>
                <tr><td class="p-2 border">การอาบน้ำ</td><td class="p-2 border"><dd data-field="ADL_Bath_Before"></dd></td><td class="p-2 border"><dd data-field="ADL_Bath_Current"></dd></td></tr>
              </tbody>
            </table>
          </div>
        </fieldset>
        
        <!-- 5. การพักผ่อน -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">5. การพักผ่อน</legend>
          <div class="preview-grid mt-2">
            <div><dt>ชั่วโมงนอน:</dt><dd data-field="Sleep_Hours"></dd></div>
            <div><dt>เพียงพอ:</dt><dd data-field="Sleep_Adequacy"></dd></div>
            <div><dt>ปัญหาการนอน:</dt><dd data-field="Sleep_Problem"></dd></div>
            <div class="col-span-full"><dt>ปัญหา (ระบุ):</dt><dd data-field="Sleep_Problem_Detail"></dd></div>
          </div>
        </fieldset>

        <!-- 6. การรับรู้ -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">6. การรับรู้และประสาทสัมผัส</legend>
          <div class="preview-grid mt-2">
            <div><dt>ระดับความรู้สึก:</dt><dd data-field="Cogn_LOC"></dd></div>
            <div><dt>การมองเห็น:</dt><dd data-field="Cogn_Vision"></dd></div>
            <div><dt>มองเห็น (อื่นๆ):</dt><dd data-field="Cogn_Vision_Other"></dd></div>
            <div><dt>การได้ยิน:</dt><dd data-field="Cogn_Hearing"></dd></div>
            <div><dt>ได้ยิน (อื่นๆ):</dt><dd data-field="Cogn_Hearing_Other"></dd></div>
            <div><dt>การพูด:</dt><dd data-field="Cogn_Speech"></dd></div>
            <div class="md:col-span-2"><dt>พูด (ภาษา):</dt><dd data-field="Cogn_Speech_Other"></dd></div>
            <div><dt>การเคลื่อนไหว:</dt><dd data-field="Cogn_Movement"></dd></div>
            <div class="md:col-span-2"><dt>เคลื่อนไหว (อื่นๆ):</dt><dd data-field="Cogn_Movement_Other"></dd></div>
          </div>
        </fieldset>
        
        <!-- 7. การรับรู้ตนเอง -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">7. การรับรู้ตนเอง</legend>
          <div class="preview-grid mt-2">
            <div><dt>กระทบภาพลักษณ์:</dt><dd data-field="Self_Image"></dd></div>
            <div class="md:col-span-2"><dt>ภาพลักษณ์ (ระบุ):</dt><dd data-field="Self_Image_Detail"></dd></div>
            <div><dt>กระทบอารมณ์:</dt><dd data-field="Self_Mood"></dd></div>
            <div class="md:col-span-2"><dt>อารมณ์ (ระบุ):</dt><dd data-field="Self_Mood_Detail"></dd></div>
            <div><dt>กระทบความสามารถ:</dt><dd data-field="Self_Ability"></dd></div>
            <div class="md:col-span-2"><dt>ความสามารถ (ระบุ):</dt><dd data-field="Self_Ability_Detail"></dd></div>
          </div>
        </fieldset>

        <!-- 8. การเผชิญภาวะเครียด -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">8. การเผชิญภาวะเครียด</legend>
          <div class="preview-grid mt-2">
            <div><dt>สิ่งไม่สบายใจ:</dt><dd data-field="Cope_Stress_Status"></dd></div>
            <div class="col-span-full"><dt>รายละเอียด (Checkbox):</dt><dd id="preview-cope-stress-details"></dd></div>
            <div class="col-span-full"><dt>รายละเอียด (อื่นๆ):</dt><dd data-field="Cope_Stress_Other_Text"></dd></div>
            <div><dt>การแสดงออก:</dt><dd data-field="Cope_Expression"></dd></div>
            <div class="md:col-span-2"><dt>แสดงออก (อื่นๆ):</dt><dd data-field="Cope_Expression_Other"></dd></div>
            <div><dt>วิธีแก้ไข:</dt><dd data-field="Cope_Method"></dd></div>
            <div class="md:col-span-2"><dt>วิธีแก้ไข (อื่นๆ):</dt><dd data-field="Cope_Method_Other"></dd></div>
          </div>
        </fieldset>

        <!-- 9. บทบาท -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">9. บทบาทและสัมพันธภาพ</legend>
          <div class="preview-grid preview-grid-4 mt-2">
            <div><dt>กระทบครอบครัว:</dt><dd data-field="Role_Effect_Family"></dd></div>
            <div><dt>กระทบอาชีพ:</dt><dd data-field="Role_Effect_Career"></dd></div>
            <div><dt>กระทบการศึกษา:</dt><dd data-field="Role_Effect_Education"></dd></div>
            <div><dt>กระทบสัมพันธภาพ:</dt><dd data-field="Role_Effect_Relationship"></dd></div>
          </div>
        </fieldset>

        <!-- 10. เพศ -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">10. เพศและการเจริญพันธุ์</legend>
          <div class="preview-grid mt-2">
            <div><dt>ประจำเดือน:</dt><dd data-field="Sex_Menses"></dd></div>
            <div><dt>สถานะประจำเดือน:</dt><dd data-field="Sex_Menses_Status"></dd></div>
            <div><dt>เต้านม:</dt><dd data-field="Sex_Breast"></dd></div>
            <div><dt>อวัยวะสืบพันธ์:</dt><dd data-field="Sex_Genital"></dd></div>
          </div>
        </fieldset>
        
        <!-- 11. ความเชื่อ -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">11. คุณค่าและความเชื่อ</legend>
          <div class="preview-grid mt-2">
            <div><dt>สาเหตุที่ป่วย:</dt><dd data-field="Belief_Cause"></dd></div>
            <div class="md:col-span-2"><dt>สาเหตุ (อื่นๆ):</dt><dd data-field="Belief_Cause_Other"></dd></div>
            <div><dt>กิจทางศาสนา:</dt><dd data-field="Belief_Ritual"></dd></div>
            <div class="md:col-span-2"><dt>กิจ (ระบุ):</dt><dd data-field="Belief_Ritual_Detail"></dd></div>
            <div><dt>สิ่งยึดเหนี่ยว:</dt><dd data-field="Belief_Anchor"></dd></div>
            <div class="md:col-span-2"><dt>สิ่งยึดเหนี่ยว (ระบุ):</dt><dd data-field="Belief_Anchor_Detail"></dd></div>
          </div>
        </fieldset>
        
        <!-- 12. การมีส่วนร่วม -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">12. การมีส่วนร่วม</legend>
          <div class="preview-grid mt-2">
            <div><dt>สถานะ:</dt><dd data-field="Partic_Status"></dd></div>
            <div class="col-span-full"><dt>ไม่ต้องการ (เนื่องจาก):</dt><dd data-field="Partic_No_Detail"></dd></div>
            <div class="col-span-full"><dt>ต้องการ (Checkbox):</dt><dd id="preview-partic-details"></dd></div>
            <div class="col-span-full"><dt>ต้องการ (อื่นๆ):</dt><dd data-field="Partic_Want_Other"></dd></div>
          </div>
        </fieldset>

        <!-- 13. Pain -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">13. PAIN MANAGEMENT</legend>
          <div class="preview-grid mt-2">
            <div><dt>สถานะปวด:</dt><dd data-field="Pain_Status"></dd></div>
            <div class="md:col-span-2"><dt>บริเวณ:</dt><dd data-field="Pain_Location"></dd></div>
            <div><dt>สาเหตุ:</dt><dd data-field="Pain_Cause"></dd></div>
            <div><dt>ลักษณะ:</dt><dd data-field="Pain_Pattern"></dd></div>
            <div class="md:col-span-2"><dt>ลักษณะ (อื่นๆ):</dt><dd data-field="Pain_Pattern_Other"></dd></div>
            <div><dt>Scale (Numeric):</dt><dd data-field="Pain_Scale_Score"></dd></div>
            <div class="md:col-span-2"><dt>Scale (Face):</dt><dd data-field="Pain_Scale_Face"></dd></div>
            <div class="col-span-full"><dt>กระทบต่อ:</dt><dd id="preview-pain-effect"></dd></div>
            <div class="col-span-full"><dt>สิ่งที่บรรเทา:</dt><dd id="preview-pain-relief"></dd></div>
          </div>
        </fieldset>
        
        <!-- 14. Braden -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">14. Braden Scale</legend>
          <div class="preview-grid mt-2">
            <div><dt>การรับรู้:</dt><dd data-field="Braden_Sensory"></dd></div>
            <div><dt>ความเปียกชื้น:</dt><dd data-field="Braden_Moisture"></dd></div>
            <div><dt>กิจกรรม:</dt><dd data-field="Braden_Activity"></dd></div>
            <div><dt>การเคลื่อนไหว:</dt><dd data-field="Braden_Mobility"></dd></div>
            <div><dt>โภชนาการ:</dt><dd data-field="Braden_Nutrition"></dd></div>
            <div><dt>การเสียดสี:</dt><dd data-field="Braden_Friction"></dd></div>
            <div class="md:col-span-2"><dt>คะแนนรวม (Total):</dt><dd data-field="Braden_Total" class="font-bold text-blue-700"></dd></div>
            <div><dt>แปลผล:</dt><dd data-field="Braden_Result"></dd></div>
          </div>
        </fieldset>

        <!-- 15. Fall Risk -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">15. Fall risk assessment</legend>
          <div class="preview-grid preview-grid-4 mt-2">
            <div><dt>วัยเด็ก:</dt><dd data-field="Fall_Age_Child"></dd></div>
            <div><dt>ผู้สูงอายุ >65:</dt><dd data-field="Fall_Age_Elder"></dd></div>
            <div><dt>สภาวะทางจิต:</dt><dd data-field="Fall_Mental"></dd></div>
            <div><dt>ประวัติหกล้ม:</dt><dd data-field="Fall_History"></dd></div>
            <div><dt>ใช้ยา:</dt><dd data-field="Fall_Meds"></dd></div>
            <div><dt>การมองเห็น:</dt><dd data-field="Fall_Vision"></dd></div>
            <div><dt>การเดิน/ทรงตัว:</dt><dd data-field="Fall_Gait"></dd></div>
            <div><dt>ผลลัพธ์:</dt><dd data-field="Fall_Result"></dd></div>
          </div>
        </fieldset>
        
        <!-- ผู้ประเมิน -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">ผู้ประเมิน</legend>
          <div class="preview-grid mt-2">
            <div class="md:col-span-2"><dt>ชื่อผู้ประเมิน:</dt><dd data-field="Assessor_Name"></dd></div>
            <div><dt>ตำแหน่ง:</dt><dd data-field="Assessor_Position"></dd></div>
            <div class="col-span-full"><dt>อัปเดตล่าสุด:</dt><dd data-field="LastUpdatedTime" id="preview-last-updated-time"></dd></div>
            <div class="col-span-full"><dt>อัปเดตโดย:</dt><dd data-field="LastUpdatedBy"></dd></div>
          </div>
        </fieldset>
      </div>
    </template>

    <!-- (Template รายการ 1:N) -->
    <template id="template-entry-list">
      <div class="divide-y divide-gray-200">
        <!-- (JS จะเติม Header และ รายการที่นี่) -->
      </div>
    </template>

    <!-- (Template Discharge Plan) -->
    <template id="preview-template-advice">
  <div class="p-4 bg-white font-sarabun text-sm">
    <h3 class="text-xl font-bold text-center mb-4">การให้คำแนะนำการปฏิบัติตัวระหว่างเข้ารับการรักษาในโรงพยาบาลและเมื่อผู้ป่วยกลับบ้าน</h3>
    
    <div class="overflow-x-auto">
      <table class="w-full border-collapse border border-gray-400">
        <thead>
          <tr class="bg-gray-100">
            <th class="border border-gray-400 p-2 w-1/6 text-center">เรื่อง</th>
            <th class="border border-gray-400 p-2 w-1/2 text-center">คำแนะนำ</th>
            <th class="border border-gray-400 p-2 text-center">ว/ด/ป ที่ให้</th>
            <th class="border border-gray-400 p-2 text-center">ผู้ให้</th>
            <th class="border border-gray-400 p-2 text-center">ผู้รับ</th>
          </tr>
        </thead>
        <tbody class="align-top">
          <tr>
            <td class="border border-gray-400 p-2 font-bold">D=Diagnosis การให้ความรู้เรื่องโรค</td>
            <td class="border border-gray-400 p-2">
              <div>ให้ความรู้เรื่องโรคที่เป็นอยู่ถึงสาเหตุ อาการ การปฏิบัติตัว ระบุ:</div>
              <div class="ml-2 text-blue-700 border-b border-dotted border-gray-300" data-field="D_Detail"></div>
            </td>
            <td class="border border-gray-400 p-2 text-center" data-field="D_Date"></td>
            <td class="border border-gray-400 p-2 text-center" data-field="D_Giver"></td>
            <td class="border border-gray-400 p-2 text-center" data-field="D_Receiver"></td>
          </tr>
          <tr>
            <td class="border border-gray-400 p-2 font-bold">M=Medicine การให้ความรู้เรื่องยา</td>
            <td class="border border-gray-400 p-2">
               <div>ชนิดของยา: <span class="text-blue-700" data-field="M_Detail"></span></div>
               <div>ฤทธิ์ของยา / ผลข้างเคียง: <span class="text-blue-700" data-field="M_SideEffect"></span></div>
            </td>
            <td class="border border-gray-400 p-2 text-center" data-field="M_Date"></td>
            <td class="border border-gray-400 p-2 text-center" data-field="M_Giver"></td>
            <td class="border border-gray-400 p-2 text-center" data-field="M_Receiver"></td>
          </tr>
          <tr>
            <td class="border border-gray-400 p-2 font-bold">E=Environment & Economic<br>การให้ความรู้ด้านสิ่งแวดล้อมและสภาวะเศรษฐกิจ</td>
            <td class="border border-gray-400 p-2">
              <div class="font-bold mb-1">- การดำรงชีวิตที่เหมาะสมกับสภาวะของโรค</div>
              <div class="grid grid-cols-1 gap-1 ml-2">
                <div>[<span data-field="E_Nutrition"></span>] การจัดการโภชนาการที่เหมาะสม</div>
                <div>[<span data-field="E_Exercise"></span>] การออกกำลังกายที่สม่ำเสมอ</div>
                <div>[<span data-field="E_Meds"></span>] การใช้ยาและการปฏิบัติตามแผนการรักษา</div>
                <div>[<span data-field="E_Stress"></span>] การจัดการอารมณ์และความเครียด</div>
                <div>[<span data-field="E_Complication"></span>] การป้องกันภาวะแทรกซ้อนและการดูแลตนเอง</div>
              </div>
              <div class="font-bold mt-2 mb-1">- ผู้ป่วยจำเป็นที่จะต้องได้รับการดูแลช่วยเหลือในเรื่อง</div>
              <div class="grid grid-cols-1 gap-1 ml-2">
                <div>[<span data-field="E_Support"></span>] การสนับสนุนการมีส่วนร่วมของครอบครัวในการดูแลผู้ป่วย</div>
                <div>[<span data-field="E_Economic"></span>] การช่วยเหลือด้านสภาวะเศรษฐกิจ ปัญหาด้านสิทธิ์การรักษา</div>
              </div>
            </td>
            <td class="border border-gray-400 p-2 text-center" data-field="E_Date"></td>
            <td class="border border-gray-400 p-2 text-center" data-field="E_Giver"></td>
            <td class="border border-gray-400 p-2 text-center" data-field="E_Receiver"></td>
          </tr>
          <tr>
            <td class="border border-gray-400 p-2 font-bold">T=Treatment แนวทางการรักษาพยาบาล</td>
            <td class="border border-gray-400 p-2">
               <div class="font-bold mb-1">- แนวทางการรักษาพยาบาล</div>
               <div class="flex flex-wrap gap-2 ml-2 mb-2">
                 <span>[<span data-field="T_MedTreatment"></span>] การรักษาด้วยยา</span>
                 <span>[<span data-field="T_IV"></span>] การให้สารน้ำ</span>
                 <span>[<span data-field="T_Blood"></span>] ให้เลือด</span>
                 <span>[<span data-field="T_Surgery"></span>] การผ่าตัด/หัตถการ ระบุ: <span data-field="T_Surgery_Text" class="text-blue-700"></span></span>
                 <span>[<span data-field="T_Other"></span>] อื่นๆ ระบุ: <span data-field="T_Other_Text" class="text-blue-700"></span></span>
               </div>
               <div class="font-bold mb-1">- สาธิตวิธีการดูแลตนเองในเรื่อง</div>
               <div class="flex flex-wrap gap-2 ml-2 mb-2">
                 <span>[<span data-field="T_TubeFeeding"></span>] การให้อาหารทางสายยาง</span>
                 <span>[<span data-field="T_WoundCare"></span>] การดูแลแผล</span>
                 <span>[<span data-field="T_SelfCare_Other"></span>] อื่นๆ ระบุ: <span data-field="T_SelfCare_Other_Text" class="text-blue-700"></span></span>
               </div>
               <div class="font-bold mb-1">- ความสำคัญในการดูแลสุขภาพและการปฏิบัติตัวที่ถูกต้อง</div>
               <div class="grid grid-cols-1 gap-1 ml-2">
                 <div>[<span data-field="T_CorrectMeds"></span>] รับประทานยาให้ถูกขนาด ถูกเวลา และต่อเนื่อง</div>
                 <div>[<span data-field="T_ControlDiet"></span>] ควบคุมและเลือกทานอาหารตามคำแนะนำเฉพาะโรค</div>
                 <div>[<span data-field="T_ExerciseRegular"></span>] ออกกำลังกายอย่างสม่ำเสมอและเหมาะสมกับสภาพร่างกาย</div>
                 <div>[<span data-field="T_Monitor"></span>] ตรวจวัด น้ำตาล ความดัน และ สังเกตอาการผิดปกติ</div>
                 <div>[<span data-field="T_NoSmoke"></span>] งด การสูบบุหรี่ และเครื่องดื่มแอลกอฮอล์ทุกชนิด</div>
                 <div>[<span data-field="T_ObserveWound"></span>] สังเกตและ ดูแลบาดแผลหรืออาการผิดปกติ</div>
               </div>
            </td>
            <td class="border border-gray-400 p-2 text-center" data-field="T_Date"></td>
            <td class="border border-gray-400 p-2 text-center" data-field="T_Giver"></td>
            <td class="border border-gray-400 p-2 text-center" data-field="T_Receiver"></td>
          </tr>
          <tr>
             <td class="border border-gray-400 p-2 font-bold">H=Health ภาวะสุขภาพ โรคที่เจ็บป่วย การส่งเสริมสุขภาพด้านร่างกาย จิตใจ</td>
             <td class="border border-gray-400 p-2">
                <div class="font-bold mb-1">- ความรู้เรื่องการลดปัจจัยเสี่ยงต่อการเกิดโรคของผู้ป่วย</div>
                <div class="grid grid-cols-1 gap-1 ml-2 mb-2">
                   <div>[<span data-field="H_DietControl"></span>] ควบคุมอาหารตามหลักโภชนาการ</div>
                   <div>[<span data-field="H_Exercise"></span>] ออกกำลังกายสม่ำเสมอ</div>
                   <div>[<span data-field="H_NoSmoke"></span>] งด การสูบบุหรี่ และเครื่องดื่มแอลกอฮอล์ทุกชนิด</div>
                   <div>[<span data-field="H_Stress"></span>] จัดการความเครียด/พักผ่อนให้เพียงพอ</div>
                   <div>[<span data-field="H_MedsPlan"></span>] ใช้ยาตามแผนการรักษา อย่างเคร่งครัด</div>
                   <div>[<span data-field="H_Infection"></span>] หลีกเลี่ยงความเสี่ยงต่อการติดเชื้อ</div>
                </div>
                <div class="font-bold mb-1">- Empowerment การดูแลสุขภาพที่เหมาะสม เรื่อง</div>
                <div class="flex flex-wrap gap-2 ml-2">
                   <span>[<span data-field="H_Emp_Knowledge"></span>] ความรู้ที่ถูกต้องเกี่ยวกับโรค</span>
                   <span>[<span data-field="H_Emp_Skill"></span>] ทักษะในการจัดการตนเอง</span>
                   <span>[<span data-field="H_Emp_Goal"></span>] การตั้งเป้าหมายการดูแลสุขภาพ</span>
                </div>
             </td>
             <td class="border border-gray-400 p-2 text-center" data-field="H_Date"></td>
             <td class="border border-gray-400 p-2 text-center" data-field="H_Giver"></td>
             <td class="border border-gray-400 p-2 text-center" data-field="H_Receiver"></td>
          </tr>
          <tr>
             <td class="border border-gray-400 p-2 font-bold">O=Out Patient การดูแลต่อเนื่อง</td>
             <td class="border border-gray-400 p-2">
                <div>- การมาตรวจตามนัด วันที่ <span class="text-blue-700" data-field="O_AppointDate"></span> สถานที่ <span class="text-blue-700" data-field="O_AppointPlace"></span></div>
                <div>- การเตรียมตัว <span class="text-blue-700" data-field="O_Prep"></span></div>
                <div class="font-bold mt-1">- แหล่งข้อมูลเครือข่ายหรือแหล่งสนับสนุนทางสังคมที่ผู้ป่วยสามารถเข้าถึงบริการ</div>
                <div class="flex flex-wrap gap-2 ml-2">
                   <span>[<span data-field="O_CommunityLeader"></span>] ผู้นำชุมชน</span>
                   <span>[<span data-field="O_Volunteer"></span>] อสม</span>
                   <span>[<span data-field="O_HealthCenter"></span>] รพ.สต.</span>
                   <span>[<span data-field="O_SupportOther"></span>] อื่นๆ <span class="text-blue-700" data-field="O_SupportOther_Text"></span></span>
                </div>
                <div class="mt-1">- การขอความช่วยเหลือ 1669</div>
             </td>
             <td class="border border-gray-400 p-2 text-center" data-field="O_Date"></td>
             <td class="border border-gray-400 p-2 text-center" data-field="O_Giver"></td>
             <td class="border border-gray-400 p-2 text-center" data-field="O_Receiver"></td>
          </tr>
          <tr>
             <td class="border border-gray-400 p-2 font-bold">D=Diet การเลือกรับประทานอาหาร</td>
             <td class="border border-gray-400 p-2">
                <div class="mb-1">ความรู้ความเข้าใจด้านอาหารที่เหมาะสม กับสภาวะของโรคและสร้างเสริมสุขภาพ</div>
                <div>- อาหารเฉพาะโรค ระบุ <span class="text-blue-700" data-field="D_Diet_Specific"></span></div>
                <div>- อาหารที่ควรหลีกเลี่ยง <span class="text-blue-700" data-field="D_Diet_Avoid"></span></div>
                <div>- อื่นๆ <span class="text-blue-700" data-field="D_Diet_Other"></span></div>
             </td>
             <td class="border border-gray-400 p-2 text-center" data-field="D_Diet_Date"></td>
             <td class="border border-gray-400 p-2 text-center" data-field="D_Diet_Giver"></td>
             <td class="border border-gray-400 p-2 text-center" data-field="D_Diet_Receiver"></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</template>
    
    <!-- (Template 005) -->
    <template id="preview-template-005">
      <div class="overflow-x-auto">
        <table class="w-full min-w-max">
          <thead class="bg-gray-100 text-sm text-gray-700">
            <tr>
              <th class="p-2 border text-center w-12">ลำดับ</th>
              <th class="p-2 border text-left">ปัญหา (FOCUS / PROBLEM)</th>
              <th class="p-2 border text-left">เป้าหมาย (Goal/Outcome)</th>
              <th class="p-2 border text-center w-28">วันที่พบ</th>
              <th class="p-2 border text-center w-28">วันที่สิ้นสุด</th>
              <th class="p-2 border text-center w-20">แก้ไข</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            <!-- (JS จะเติมรายการปัญหาที่นี่) -->
          </tbody>
        </table>
      </div>
    </template>
    <template id="preview-template-006">
      <div class="overflow-x-auto">
        <table class="w-full min-w-[1200px] text-sm text-left text-gray-700 border border-collapse">
          <thead class="text-xs text-gray-700 uppercase bg-gray-200">
            <tr>
              <th class="p-3 border text-center w-28">วัน / เวร</th>
              <th class="p-3 border text-center w-20">เวลา</th>
              <th class="p-3 border text-left w-1/6">FOCUS</th>
              <th class="p-3 border text-left">S: Subjective</th>
              <th class="p-3 border text-left">O: Objective</th>
              <th class="p-3 border text-left">I: Intervention</th>
              <th class="p-3 border text-left">E: Evaluation</th>
              <th class="p-3 border text-center w-32">พยาบาล</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            </tbody>
        </table>
      </div>
    </template>

    <template id="preview-template-007">
      <div class="p-6 space-y-6 bg-white text-sm font-sarabun">
        
        <div class="grid grid-cols-2 gap-4 border-b pb-4 bg-gray-50 p-4 rounded">
          <div><span class="font-bold text-gray-700">วันที่จำหน่าย:</span> <span data-field="DischargeDate"></span></div>
          <div><span class="font-bold text-gray-700">วันที่ออก/เวลา:</span> <span data-field="LeaveDate"></span> เวลา <span data-field="LeaveTime"></span> น.</div>
          <div>
             <span class="font-bold text-gray-700">ประเภท:</span> <span data-field="DischargeType"></span>
          </div>
          <div>
             <span class="font-bold text-gray-700">สภาพ:</span> <span data-field="DischargeStatus"></span>
          </div>
        </div>

        <div class="border p-3 rounded">
            <h4 class="font-bold text-blue-800 mb-2">สรุปอาการและอาการแสดงผู้ป่วยก่อนจำหน่าย</h4>
            <div class="grid grid-cols-2 md:grid-cols-5 gap-2 mb-2">
                <div><b>BT:</b> <span data-field="VS_BT"></span> °C</div>
                <div><b>PR:</b> <span data-field="VS_PR"></span> /min</div>
                <div><b>RR:</b> <span data-field="VS_RR"></span> /min</div>
                <div><b>BP:</b> <span data-field="VS_BP"></span> mmHg</div>
                <div><b>อื่นๆ:</b> <span data-field="VS_Other"></span></div>
            </div>
            <div><b>อาการและอาการแสดง:</b> <span data-field="Symp_Before_Discharge"></span></div>
        </div>

        <div class="border p-4 rounded">
            <h4 class="font-bold text-lg text-indigo-800 mb-3 underline">การสอนสุขศึกษา / D-METHOD</h4>
            
            <div class="space-y-3">
                <div>
                    <div class="font-bold text-red-700">1. D (Disease) ความรู้เรื่องโรค/การสังเกตอาการผิดปกติ</div>
                    <div class="ml-4 grid grid-cols-2 md:grid-cols-3 gap-1 text-gray-600">
                        <div>[<span data-field="D_Fever"></span>] มีไข้สูง</div>
                        <div>[<span data-field="D_Wound"></span>] แผลบวมแดง/มีหนอง</div>
                        <div>[<span data-field="D_Drowsy"></span>] ซึม/รู้สึกตัวเปลี่ยน</div>
                        <div>[<span data-field="D_Dyspnea"></span>] หายใจหอบ</div>
                        <div class="col-span-2">[<span data-field="D_Other"></span>] อื่นๆ: <span data-field="D_Other_Text"></span></div>
                    </div>
                </div>

                <div>
                    <div class="font-bold text-blue-700">2. M (Medication) ยา</div>
                    <div class="ml-4 p-2 bg-gray-50 rounded border border-gray-200">
                        <span data-field="M_Details"></span>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <div class="font-bold">3. E (Environment)</div>
                        <div class="ml-2 text-xs">
                            <div>[<span data-field="E_Clean"></span>] จัดสิ่งแวดล้อม</div>
                            <div>[<span data-field="E_Other"></span>] อื่นๆ: <span data-field="E_Other_Text"></span></div>
                        </div>
                    </div>
                    <div>
                        <div class="font-bold">4. T (Treatment)</div>
                        <div class="ml-2 text-xs">
                            <div>[<span data-field="T_CleanBody"></span>] ความสะอาดร่างกาย</div>
                            <div>[<span data-field="T_WoundCare"></span>] ทำแผล</div>
                            <div>[<span data-field="T_Other"></span>] <span data-field="T_Other_Text"></span></div>
                        </div>
                    </div>
                    <div>
                        <div class="font-bold">5. H (Health)</div>
                        <div class="ml-2 text-xs">
                            <div>[<span data-field="H_Exercise"></span>] ออกกำลังกาย/พักผ่อน</div>
                            <div>[<span data-field="H_Other"></span>] <span data-field="H_Other_Text"></span></div>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="font-bold">6. O (Outpatient) การมาตรวจตามนัด</div>
                    <div class="ml-4"><span data-field="O_Refer"></span></div>
                </div>

                <div>
                    <div class="font-bold text-green-700">7. D (Diet) อาหาร</div>
                    <div class="ml-4 grid grid-cols-2 md:grid-cols-4 gap-1 text-xs text-gray-600">
                        <div>[<span data-field="D_Diet_5Group"></span>] ครบ 5 หมู่</div>
                        <div>[<span data-field="D_Diet_Soft"></span>] อ่อน</div>
                        <div>[<span data-field="D_Diet_Cooked"></span>] สุกสะอาด</div>
                        <div>[<span data-field="D_Diet_Protein"></span>] เนื้อ นม ไข่</div>
                        <div>[<span data-field="D_Diet_AvoidFat"></span>] เลี่ยงไขมันสูง</div>
                        <div>[<span data-field="D_Diet_NoVeg"></span>] งดผักผลไม้</div>
                        <div class="col-span-2">[<span data-field="D_Diet_Other"></span>] อื่นๆ: <span data-field="D_Diet_Other_Text"></span></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm border-t pt-4 bg-yellow-50 p-4 rounded">
             <div>
                 <b>ยา/อุปกรณ์กลับบ้าน:</b> <span data-field="Supplies_Status"></span> <span data-field="Supplies_Note"></span>
             </div>
             <div>
                 <b>การดูแลต่อ (F/U):</b> 
                 [<span data-field="FU_No"></span>] ไม่มี 
                 [<span data-field="FU_Yes"></span>] มีนัด: <span data-field="FU_Date"></span>
             </div>
             <div class="md:col-span-2">
                 <b>การดูแลแผล:</b> 
                 [<span data-field="Care_Wound"></span>] ล้างแผลทุกวัน 
                 [<span data-field="Care_Stitch"></span>] ตัดไหมวันที่: <span data-field="Care_Stitch_Date"></span>
             </div>
             <div class="md:col-span-2 border-t border-yellow-200 pt-2 mt-2">
                 <b>สถานที่ส่งต่อ:</b> 
                 [<span data-field="Dest_Center"></span>] รพ.ศ. 
                 [<span data-field="Dest_General"></span>] รพ.ท. 
                 [<span data-field="Dest_Community"></span>] รพ.ช. 
                 [<span data-field="Dest_HealthCenter"></span>] รพ.สต. 
                 [<span data-field="Dest_Other"></span>] อื่นๆ: <span data-field="Dest_Other_Text"></span>
             </div>
             <div><b>ผู้รับกลับ:</b> <span data-field="Pickup_Name"></span> (<span data-field="Pickup_Rel"></span>)</div>
             <div class="text-right">
                <div class="font-bold text-indigo-600 text-lg">ลงชื่อ: <span data-field="Nurse_Name"></span></div>
                <div class="text-gray-500">ตำแหน่ง: <span data-field="Nurse_Pos"></span></div>
             </div>
        </div>
      </div>
    </template>

    <template id="preview-template-morse">
      <div class="p-4">
        <div id="morse-summary-list" class="space-y-3">
            </div>
        <div id="morse-empty-state" class="text-center text-gray-500 py-8 hidden">
            <p>ยังไม่มีประวัติการประเมิน</p>
            <p class="text-sm">กดปุ่ม <b>"แก้ไข"</b> เพื่อเริ่มการประเมิน</p>
        </div>
      </div>
    </template>

    <template id="preview-template-braden">
  <div class="p-4">
    <div id="braden-summary-list" class="space-y-3">
        </div>
    <div id="braden-empty-state" class="text-center text-gray-500 py-8 hidden">
        <p>ยังไม่มีประวัติการประเมิน</p>
        <button class="mt-4 bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600" onclick="openBradenModal()">
            + เริ่มประเมิน
        </button>
    </div>
  </div>
</template>

    <!-- ============================================= -->
    <!-- (5) MODALS (Pop-ups) -->
    <!-- ============================================= -->

    <!-- (Modal: Admit) -->
    <div id="admit-modal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-start pt-16 z-50 hidden overflow-y-auto">
      <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[85vh] m-4">
        <div class="flex justify-between items-center p-4 border-b">
          <h3 class="text-xl font-semibold text-gray-800">บันทึกรับใหม่ (Admit Patient)</h3>
          <button id="close-admit-modal-btn" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
        </div>
        <form id="admit-form" class="p-6 overflow-y-auto max-h-[calc(85vh-130px)]">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div class="col-span-1">
                <label for="admit-date" class="block text-sm font-medium text-gray-700">วันที่รับ</label>
                <input type="date" id="admit-date" name="AdmitDate" class="mt-1 p-2 block w-full border rounded-md" required>
              </div>
              <div class="col-span-1">
                <label for="admit-time" class="block text-sm font-medium text-gray-700">เวลารับ</label>
                <input type="time" id="admit-time" name="AdmitTime" class="mt-1 p-2 block w-full border rounded-md" required>
              </div>
              <div class="col-span-1">
                <label for="admit-from" class="block text-sm font-medium text-gray-700">รับจาก</label>
                <select id="admit-from" name="AdmittedFrom" class="mt-1 p-2 block w-full border rounded-md" required>
                  </select>
              </div>
              
              <div class="col-span-2">
                <label for="admit-refer" class="block text-sm font-medium text-gray-700">Refer (ถ้ามี)</label>
                <input type="text" id="admit-refer" name="Refer" class="mt-1 p-2 block w-full border rounded-md">
              </div>
              <div class="col-span-1">
                <label for="admit-bed" class="block text-sm font-medium text-gray-700">รับเข้าเตียง</label>
                <select id="admit-bed" name="Bed" class="mt-1 p-2 block w-full border rounded-md" required>
                  <option value="">-- เลือกเตียงว่าง --</option>
                  </select>
              </div>

              <hr class="md:col-span-3 my-2">

              <div class="col-span-1">
                <label for="admit-hn" class="block text-sm font-medium text-gray-700">HN</label>
                <input type="text" id="admit-hn" name="HN" class="mt-1 p-2 block w-full border rounded-md" required>
              </div>
              <div class="col-span-1">
                <label for="admit-an" class="block text-sm font-medium text-gray-700">AN (คีย์หลัก)</label>
                <input type="text" id="admit-an" name="AN" class="mt-1 p-2 block w-full border rounded-md" required>
              </div>
              <div class="col-span-1">
                <label for="admit-name" class="block text-sm font-medium text-gray-700">ชื่อ-สกุล</label>
                <input type="text" id="admit-name" name="Name" class="mt-1 p-2 block w-full border rounded-md" required>
              </div>

              <div class="md:col-span-3">
                <label for="admit-address" class="block text-sm font-medium text-gray-700">ที่อยู่</label>
                <textarea id="admit-address" name="Address" rows="2" class="mt-1 p-2 block w-full border rounded-md"></textarea>
              </div>

              <div class="col-span-1">
                <label for="admit-dob" class="block text-sm font-medium text-gray-700">วันเกิด (ค.ศ.)</label>
                <input type="date" id="admit-dob" name="DOB_BE" class="mt-1 p-2 block w-full border rounded-md" required>
              </div>
              <div class="col-span-1">
                <label for="admit-age" class="block text-sm font-medium text-gray-700">อายุ</label>
                <input type="text" id="admit-age" class="mt-1 p-2 block w-full border rounded-md bg-gray-200" readonly>
              </div>
              <div class="col-span-1">
                <label for="admit-dept" class="block text-sm font-medium text-gray-700">แผนก</label>
                <select id="admit-dept" name="Dept" class="mt-1 p-2 block w-full border rounded-md" required>
                  </select>
              </div>
              
              <hr class="md:col-span-3 my-2">

              <div class="md:col-span-3">
                <label for="admit-cc" class="block text-sm font-medium text-gray-700">อาการสำคัญ (CC)</label>
                <textarea id="admit-cc" name="ChiefComplaint" rows="2" class="mt-1 p-2 block w-full border rounded-md"></textarea>
              </div>
              <div class="md:col-span-3">
                <label for="admit-pi" class="block text-sm font-medium text-gray-700">ประวัติการเจ็บป่วย (PI)</label>
                <textarea id="admit-pi" name="PresentIllness" rows="3" class="mt-1 p-2 block w-full border rounded-md"></textarea>
              </div>

              <div class="col-span-2">
                <label for="admit-dx" class="block text-sm font-medium text-gray-700">การวินิจฉัยแรกรับ (Admitting Dx)</label>
                <input type="text" id="admit-dx" name="AdmittingDx" class="mt-1 p-2 block w-full border rounded-md">
              </div>
              <div class="col-span-1">
                <label for="admit-doctor" class="block text-sm font-medium text-gray-700">แพทย์เจ้าของไข้</label>
                <input type="text" id="admit-doctor" name="Doctor" list="doctor-list" class="mt-1 p-2 block w-full border rounded-md" placeholder="พิมพ์ชื่อเพื่อค้นหา..." required>
                <datalist id="doctor-list"></datalist> 
              </div>

            </div>
        </form>
        <div class="flex justify-end items-center p-4 border-t bg-gray-50 rounded-b-lg">
            <button id="cancel-admit-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg mr-3">
              ยกเลิก
            </button>
            <button type="submit" form="admit-form" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow">
              บันทึกข้อมูล
            </button>
        </div>
      </div>
    </div>

    <!-- (Modal: Details) -->
    <div id="details-modal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-start pt-16 z-50 hidden overflow-y-auto">
      <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[85vh] m-4">
        <div class="flex justify-between items-center p-4 border-b">
          <h3 class="text-xl font-semibold text-gray-800">รายละเอียดผู้ป่วย</h3>
          <button id="close-details-modal-btn" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
        </div>
        
        <fieldset id="details-fieldset" disabled>
          <form id="details-form" class="p-6 overflow-y-auto max-h-[calc(85vh-200px)]">
            
            <input type="hidden" id="details-an" name="AN">
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div class="col-span-1">
                <label class="block text-sm font-medium text-gray-700">วันที่รับ</label>
                <input type="date" id="details-date" name="AdmitDate" class="mt-1 p-2 block w-full border rounded-md bg-gray-100">
              </div>
              <div class="col-span-1">
                <label class="block text-sm font-medium text-gray-700">เวลารับ</label>
                <input type="time" id="details-time" name="AdmitTime" class="mt-1 p-2 block w-full border rounded-md bg-gray-100">
              </div>
              <div class="col-span-1">
                <label class="block text-sm font-medium text-gray-700">รับจาก</label>
                <select id="details-from" name="AdmittedFrom" class="mt-1 p-2 block w-full border rounded-md">
                  </select>
              </div>
              
              <div class="col-span-2">
                <label class="block text-sm font-medium text-gray-700">Refer</label>
                <input type="text" id="details-refer" name="Refer" class="mt-1 p-2 block w-full border rounded-md">
              </div>
              <div class="col-span-1">
                <label class="block text-sm font-medium text-gray-700">เตียง</label>
                <input type="text" id="details-bed-display" class="mt-1 p-2 block w-full border rounded-md bg-gray-100">
                <select id="details-bed-select" name="Bed" class="mt-1 p-2 block w-full border rounded-md hidden">
                  </select>
              </div>

              <hr class="md:col-span-3 my-2">

              <div class="col-span-1">
                <label class="block text-sm font-medium text-gray-700">HN</label>
                <input type="text" id="details-hn" name="HN" class="mt-1 p-2 block w-full border rounded-md bg-gray-100">
              </div>
              <div class="col-span-1">
                <label class="block text-sm font-medium text-gray-700">AN</label>
                <input type="text" id="details-an-display" class="mt-1 p-2 block w-full border rounded-md bg-gray-200" readonly>
              </div>
              <div class="col-span-1">
                <label class="block text-sm font-medium text-gray-700">ชื่อ-สกุล</label>
                <input type="text" id="details-name" name="Name" class="mt-1 p-2 block w-full border rounded-md">
              </div>

              <div class="md:col-span-3">
                <label class="block text-sm font-medium text-gray-700">ที่อยู่</label>
                <textarea id="details-address" name="Address" rows="2" class="mt-1 p-2 block w-full border rounded-md"></textarea>
              </div>

              <div class="col-span-1">
                <label class="block text-sm font-medium text-gray-700">วันเกิด (ค.ศ.)</label>
                <input type="date" id="details-dob" name="DOB_CE" class="mt-1 p-2 block w-full border rounded-md">
              </div>
              <div class="col-span-1">
                <label class="block text-sm font-medium text-gray-700">อายุ</label>
                <input type="text" id="details-age" class="mt-1 p-2 block w-full border rounded-md bg-gray-200" readonly>
              </div>
              <div class="col-span-1">
                <label class="block text-sm font-medium text-gray-700">แผนก</label>
                <select id="details-dept" name="Dept" class="mt-1 p-2 block w-full border rounded-md">
                  </select>
              </div>
              
              <hr class="md:col-span-3 my-2">

              <div class="md:col-span-3">
                <label class="block text-sm font-medium text-gray-700">อาการสำคัญ (CC)</label>
                <textarea id="details-cc" name="ChiefComplaint" rows="2" class="mt-1 p-2 block w-full border rounded-md"></textarea>
              </div>
              <div class="md:col-span-3">
                <label class="block text-sm font-medium text-gray-700">ประวัติการเจ็บป่วย (PI)</label>
                <textarea id="details-pi" name="PresentIllness" rows="3" class="mt-1 p-2 block w-full border rounded-md"></textarea>
              </div>

              <div class="col-span-2">
                <label class="block text-sm font-medium text-gray-700">การวินิจฉัยแรกรับ (Admitting Dx)</label>
                <input type="text" id="details-dx" name="AdmittingDx" class="mt-1 p-2 block w-full border rounded-md">
              </div>
              <div class="col-span-1">
                <label class="block text-sm font-medium text-gray-700">แพทย์เจ้าของไข้</label>
                <input type="text" id="details-doctor" name="Doctor" list="doctor-list" class="mt-1 p-2 block w-full border rounded-md">
              </div>

            </div>
          </form>
        </fieldset>
        
        <div class="flex justify-between items-center p-4 border-t bg-gray-50 rounded-b-lg">
          <div>
            <button id="transfer-ward-btn" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg mr-2 hidden">
              ย้ายตึก
            </button>
            <button id="discharge-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg hidden">
              จำหน่าย (Discharge)
            </button>
          </div>
        
          <div>
            <button id="edit-patient-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">
              แก้ไขข้อมูล
            </button>
            <button id="save-details-btn" type="submit" form="details-form" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg hidden">
              บันทึกการแก้ไข
            </button>
            <button id="cancel-edit-btn" class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg ml-2 hidden">
              ยกเลิก
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- (Modal: Assessment FR-IPD-004) -->
    <div id="assessment-modal" class="fixed inset-0 bg-white z-50 hidden overflow-y-auto">
      <form id="assessment-form">
        <!-- Modal Header (Sticky) -->
        <div class="sticky top-0 bg-white shadow-md z-10">
          <div class="container mx-auto px-6 py-4 flex flex-col md:flex-row justify-between md:items-center">
            <div>
              <h3 class="text-2xl font-bold text-indigo-800">แบบประเมินประวัติและสมรรถนะผู้ป่วย (FR-IPD-004)</h3>
              <p class="text-gray-600">AN: <strong id="assess-an-display" class="text-indigo-700"></strong> | ชื่อ: <strong id="assess-name-display" class="text-indigo-700"></strong></p>
            </div>
            <div class="mt-3 md:mt-0">
              <button id="close-assessment-modal-btn" type="button" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg mr-3">
                ปิด
              </button>
              <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow">
                บันทึกข้อมูล
              </button>
            </div>
          </div>
        </div>
        
        <!-- Modal Body (Scrollable) -->
        <div class="container mx-auto px-6 py-8">
          <div class="space-y-8">
            <!-- (เนื้อหา FR-IPD-004 จะถูกสร้างโดย JS ผ่าน Template) -->
             <fieldset class="border p-4 rounded-lg shadow-sm">
              <legend class="text-xl font-semibold px-2 text-gray-800">ข้อมูลทั่วไป (ดึงจากข้อมูลรับใหม่)</legend>
              <div class="grid grid-cols-12 gap-4 mt-4">
                <div class="col-span-12 md:col-span-3">
                  <label class="block text-sm font-medium text-gray-700">วันที่รับ</label>
                  <input type="date" id="assess-admit-date" class="mt-1 p-2 block w-full border rounded-md bg-gray-200" readonly>
                </div>
                <div class="col-span-12 md:col-span-3">
                  <label class="block text-sm font-medium text-gray-700">เวลารับ</label>
                  <input type="time" id="assess-admit-time" class="mt-1 p-2 block w-full border rounded-md bg-gray-200" readonly>
                </div>
                <div class="col-span-12 md:col-span-3">
                  <label class="block text-sm font-medium text-gray-700">รับจาก</label>
                  <input type="text" id="assess-admit-from" class="mt-1 p-2 block w-full border rounded-md bg-gray-200" readonly>
                </div>
                 <div class="col-span-12 md:col-span-3">
                  <label class="block text-sm font-medium text-gray-700">Refer จาก</label>
                  <input type="text" id="assess-refer-from" class="mt-1 p-2 block w-full border rounded-md bg-gray-200" readonly>
                </div>
                
                <!-- (ข้อมูลใหม่) -->
                <div class="col-span-12 md:col-span-3">
                  <label class="block text-sm font-medium text-gray-700">มาโดย</label>
                  <select name="ArriveBy" class="mt-1 p-2 block w-full border rounded-md">
                    <option value="">-- กรุณาเลือก --</option>
                    <option value="เดินมา">เดินมา</option>
                    <option value="รถนั่ง">รถนั่ง</option>
                    <option value="เปลนอน">เปลนอน</option>
                  </select>
                </div>
                <div class="col-span-12 md:col-span-3">
                  <label class="block text-sm font-medium text-gray-700">ผู้ให้ข้อมูล</label>
                  <select name="InfoSource" class="mt-1 p-2 block w-full border rounded-md">
                     <option value="">-- กรุณาเลือก --</option>
                    <option value="ผู้ป่วย">ผู้ป่วย</option>
                    <option value="ผู้นำส่ง/ญาติ">ผู้นำส่ง/ญาติ</option>
                  </select>
                </div>
                <div class="col-span-12 md:col-span-6">
                  <label class="block text-sm font-medium text-gray-700">ผู้ดูแลหลักชื่อ</label>
                  <input type="text" name="MainCaregiver_Name" class="mt-1 p-2 block w-full border rounded-md">
                </div>
                <div class="col-span-12 md:col-span-6">
                  <label class="block text-sm font-medium text-gray-700">ความสัมพันธ์กับผู้ป่วย</label>
                  <div class="mt-2 space-y-2 md:space-y-0 md:flex md:flex-wrap md:gap-x-6">
                    <label class="flex items-center"><input type="radio" name="MainCaregiver_Rel" value="บิดา-มารดา" class="mr-2 assessment-radio-toggle">บิดา-มารดา</label>
                    <label class="flex items-center"><input type="radio" name="MainCaregiver_Rel" value="สามี,ภรรยา,บุตร" class="mr-2 assessment-radio-toggle">สามี,ภรรยา,บุตร</label>
                    <label class="flex items-center"><input type="radio" name="MainCaregiver_Rel" value="ญาติ" class="mr-2 assessment-radio-toggle">ญาติ</label>
                    <label class="flex items-center"><input type="radio" name="MainCaregiver_Rel" value="อื่นๆ" class="mr-2 assessment-radio-toggle" data-controls="rel-other">อื่นๆ:</label>
                  </div>
                  <input type="text" name="MainCaregiver_Rel_Other_Text" id="rel-other" class="mt-1 p-2 block w-full border rounded-md hidden" placeholder="ระบุ...">
                </div>

                <div class="col-span-12">
                  <label class="block text-sm font-medium text-gray-700">อาการสำคัญ (CC)</label>
                  <textarea id="assess-cc" name="ChiefComplaint" rows="2" class="mt-1 p-2 block w-full border rounded-md"></textarea>
                </div>
                <div class="col-span-12">
                  <label class="block text-sm font-medium text-gray-700">ประวัติการเจ็บป่วยปัจจุบัน (PI)</label>
                  <textarea id="assess-pi" name="PresentIllness" rows="3" class="mt-1 p-2 block w-full border rounded-md"></textarea>
                </div>
                <div class="col-span-12">
                  <label class="block text-sm font-medium text-gray-700">อาการและอาการแสดงแรกรับ</label>
                  <textarea name="AdmitSymptoms" rows="2" class="mt-1 p-2 block w-full border rounded-md"></textarea>
                </div>

                <div class="col-span-12 md:col-span-3">
                  <label class="block text-sm font-medium text-gray-700">BT (ฐC)</label>
                  <input type="text" name="Admit_BT" class="mt-1 p-2 block w-full border rounded-md">
                </div>
                 <div class="col-span-12 md:col-span-3">
                  <label class="block text-sm font-medium text-gray-700">PR (ครั้ง/min)</label>
                  <input type="text" name="Admit_PR" class="mt-1 p-2 block w-full border rounded-md">
                </div>
                 <div class="col-span-12 md:col-span-3">
                  <label class="block text-sm font-medium text-gray-700">RR (ครั้ง/min)</label>
                  <input type="text" name="Admit_RR" class="mt-1 p-2 block w-full border rounded-md">
                </div>
                 <div class="col-span-12 md:col-span-3">
                  <label class="block text-sm font-medium text-gray-700">BP (mmHg)</label>
                  <input type="text" name="Admit_BP" class="mt-1 p-2 block w-full border rounded-md">
                </div>
              </div>
            </fieldset>

            <!-- 1. การรับรู้สุขภาพ -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">1. การรับรู้สุขภาพ</legend>
          <div class="preview-grid mt-2">
            <div><dt>ก่อนป่วย:</dt><dd data-field="HP_Before"></dd></div>
            <div class="md:col-span-2"><dt>รายละเอียด (ก่อนป่วย):</dt><dd data-field="HP_Before_Detail"></dd></div>
            <div><dt>ครั้งนี้:</dt><dd data-field="HP_Current"></dd></div>
            <div><dt>การดูแล:</dt><dd data-field="HP_Care"></dd></div>
            <div class="md:col-span-2"><dt>ดูแล (อื่นๆ):</dt><dd data-field="HP_Care_Other"></dd></div>
            <div class="col-span-full"><dt>ความคาดหวัง:</dt><dd data-field="HP_Expect"></dd></div>
          </div>
        </fieldset>

        <!-- 2. โภชนาการ -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">2. โภชนาการ</legend>
          <div class="preview-grid mt-2">
            <div><dt>รับประทาน:</dt><dd data-field="Nutri_Meals"></dd></div>
            <div><dt>ประเภทอาหาร:</dt><dd data-field="Nutri_Type"></dd></div>
            <div><dt>อาหารเฉพาะโรค:</dt><dd data-field="Nutri_Type_Detail"></dd></div>
            <div><dt>ปัญหาการกิน:</dt><dd data-field="Nutri_Problem"></dd></div>
            <div><dt>ผิวหนัง:</dt><dd data-field="Nutri_Skin"></dd></div>
            <div class="md:col-span-2"><dt>ผิวหนัง (ระบุ):</dt><dd data-field="Nutri_Skin_Detail"></dd></div>
          </div>
        </fieldset>

        <!-- 3. การขับถ่าย -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">3. การขับถ่าย</legend>
          <div class="preview-grid mt-2">
            <div><dt>ปัสสาวะ (ครั้ง/วัน):</dt><dd data-field="Elim_Urine_Freq"></dd></div>
            <div><dt>สถานะปัสสาวะ:</dt><dd data-field="Elim_Urine_Status"></dd></div>
            <div><dt>ปัสสาวะ (ระบุ):</dt><dd data-field="Elim_Urine_Detail"></dd></div>
            <div><dt>อุจจาระ (ครั้ง/วัน):</dt><dd data-field="Elim_Bowel_Freq"></dd></div>
            <div><dt>สถานะอุจจาระ:</dt><dd data-field="Elim_Bowel_Status"></dd></div>
            <div><dt>อุจจาระ (ระบุ):</dt><dd data-field="Elim_Bowel_Detail"></dd></div>
            <div class="col-span-full"><dt>ขับถ่ายทางหน้าท้อง:</dt><dd data-field="Elim_Stoma"></dd></div>
          </div>
        </fieldset>

        <!-- 4. ADL -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">4. กิจวัตรประจำวัน (ADL)</legend>
          <div class="overflow-x-auto mt-2">
            <table class="w-full text-sm">
              <thead class="bg-gray-50">
                <tr class="text-left">
                  <th class="p-2 border">กิจกรรม</th>
                  <th class="p-2 border">ก่อนการเจ็บป่วย</th>
                  <th class="p-2 border">ขณะเจ็บป่วย</th>
                </tr>
              </thead>
              <tbody>
                <tr><td class="p-2 border">การรับประทานอาหาร</td><td class="p-2 border"><dd data-field="ADL_Eat_Before"></dd></td><td class="p-2 border"><dd data-field="ADL_Eat_Current"></dd></td></tr>
                <tr><td class="p-2 border">การทำความสะอาดปาก/ฟัน</td><td class="p-2 border"><dd data-field="ADL_Brush_Before"></dd></td><td class="p-2 border"><dd data-field="ADL_Brush_Current"></dd></td></tr>
                <tr><td class="p-2 border">การแต่งตัว</td><td class="p-2 border"><dd data-field="ADL_Dress_Before"></dd></td><td class="p-2 border"><dd data-field="ADL_Dress_Current"></dd></td></tr>
                <tr><td class="p-2 border">การเดิน</td><td class="p-2 border"><dd data-field="ADL_Walk_Before"></dd></td><td class="p-2 border"><dd data-field="ADL_Walk_Current"></dd></td></tr>
                <tr><td class="p-2 border">การขับถ่าย</td><td class="p-2 border"><dd data-field="ADL_Toilet_Before"></dd></td><td class="p-2 border"><dd data-field="ADL_Toilet_Current"></dd></td></tr>
                <tr><td class="p-2 border">การอาบน้ำ</td><td class="p-2 border"><dd data-field="ADL_Bath_Before"></dd></td><td class="p-2 border"><dd data-field="ADL_Bath_Current"></dd></td></tr>
              </tbody>
            </table>
          </div>
        </fieldset>
        
        <!-- 5. การพักผ่อน -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">5. การพักผ่อน</legend>
          <div class="preview-grid mt-2">
            <div><dt>ชั่วโมงนอน:</dt><dd data-field="Sleep_Hours"></dd></div>
            <div><dt>เพียงพอ:</dt><dd data-field="Sleep_Adequacy"></dd></div>
            <div><dt>ปัญหาการนอน:</dt><dd data-field="Sleep_Problem"></dd></div>
            <div class="col-span-full"><dt>ปัญหา (ระบุ):</dt><dd data-field="Sleep_Problem_Detail"></dd></div>
          </div>
        </fieldset>

        <!-- 6. การรับรู้ -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">6. การรับรู้และประสาทสัมผัส</legend>
          <div class="preview-grid mt-2">
            <div><dt>ระดับความรู้สึก:</dt><dd data-field="Cogn_LOC"></dd></div>
            <div><dt>การมองเห็น:</dt><dd data-field="Cogn_Vision"></dd></div>
            <div><dt>มองเห็น (อื่นๆ):</dt><dd data-field="Cogn_Vision_Other"></dd></div>
            <div><dt>การได้ยิน:</dt><dd data-field="Cogn_Hearing"></dd></div>
            <div><dt>ได้ยิน (อื่นๆ):</dt><dd data-field="Cogn_Hearing_Other"></dd></div>
            <div><dt>การพูด:</dt><dd data-field="Cogn_Speech"></dd></div>
            <div class="md:col-span-2"><dt>พูด (ภาษา):</dt><dd data-field="Cogn_Speech_Other"></dd></div>
            <div><dt>การเคลื่อนไหว:</dt><dd data-field="Cogn_Movement"></dd></div>
            <div class="md:col-span-2"><dt>เคลื่อนไหว (อื่นๆ):</dt><dd data-field="Cogn_Movement_Other"></dd></div>
          </div>
        </fieldset>
        
        <!-- 7. การรับรู้ตนเอง -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">7. การรับรู้ตนเอง</legend>
          <div class="preview-grid mt-2">
            <div><dt>กระทบภาพลักษณ์:</dt><dd data-field="Self_Image"></dd></div>
            <div class="md:col-span-2"><dt>ภาพลักษณ์ (ระบุ):</dt><dd data-field="Self_Image_Detail"></dd></div>
            <div><dt>กระทบอารมณ์:</dt><dd data-field="Self_Mood"></dd></div>
            <div class="md:col-span-2"><dt>อารมณ์ (ระบุ):</dt><dd data-field="Self_Mood_Detail"></dd></div>
            <div><dt>กระทบความสามารถ:</dt><dd data-field="Self_Ability"></dd></div>
            <div class="md:col-span-2"><dt>ความสามารถ (ระบุ):</dt><dd data-field="Self_Ability_Detail"></dd></div>
          </div>
        </fieldset>

        <!-- 8. การเผชิญภาวะเครียด -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">8. การเผชิญภาวะเครียด</legend>
          <div class="preview-grid mt-2">
            <div><dt>สิ่งไม่สบายใจ:</dt><dd data-field="Cope_Stress_Status"></dd></div>
            <div class="col-span-full"><dt>รายละเอียด (Checkbox):</dt><dd id="preview-cope-stress-details"></dd></div>
            <div class="col-span-full"><dt>รายละเอียด (อื่นๆ):</dt><dd data-field="Cope_Stress_Other_Text"></dd></div>
            <div><dt>การแสดงออก:</dt><dd data-field="Cope_Expression"></dd></div>
            <div class="md:col-span-2"><dt>แสดงออก (อื่นๆ):</dt><dd data-field="Cope_Expression_Other"></dd></div>
            <div><dt>วิธีแก้ไข:</dt><dd data-field="Cope_Method"></dd></div>
            <div class="md:col-span-2"><dt>วิธีแก้ไข (อื่นๆ):</dt><dd data-field="Cope_Method_Other"></dd></div>
          </div>
        </fieldset>

        <!-- 9. บทบาท -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">9. บทบาทและสัมพันธภาพ</legend>
          <div class="preview-grid preview-grid-4 mt-2">
            <div><dt>กระทบครอบครัว:</dt><dd data-field="Role_Effect_Family"></dd></div>
            <div><dt>กระทบอาชีพ:</dt><dd data-field="Role_Effect_Career"></dd></div>
            <div><dt>กระทบการศึกษา:</dt><dd data-field="Role_Effect_Education"></dd></div>
            <div><dt>กระทบสัมพันธภาพ:</dt><dd data-field="Role_Effect_Relationship"></dd></div>
          </div>
        </fieldset>

        <!-- 10. เพศ -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">10. เพศและการเจริญพันธุ์</legend>
          <div class="preview-grid mt-2">
            <div><dt>ประจำเดือน:</dt><dd data-field="Sex_Menses"></dd></div>
            <div><dt>สถานะประจำเดือน:</dt><dd data-field="Sex_Menses_Status"></dd></div>
            <div><dt>เต้านม:</dt><dd data-field="Sex_Breast"></dd></div>
            <div><dt>อวัยวะสืบพันธ์:</dt><dd data-field="Sex_Genital"></dd></div>
          </div>
        </fieldset>
        
        <!-- 11. ความเชื่อ -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">11. คุณค่าและความเชื่อ</legend>
          <div class="preview-grid mt-2">
            <div><dt>สาเหตุที่ป่วย:</dt><dd data-field="Belief_Cause"></dd></div>
            <div class="md:col-span-2"><dt>สาเหตุ (อื่นๆ):</dt><dd data-field="Belief_Cause_Other"></dd></div>
            <div><dt>กิจทางศาสนา:</dt><dd data-field="Belief_Ritual"></dd></div>
            <div class="md:col-span-2"><dt>กิจ (ระบุ):</dt><dd data-field="Belief_Ritual_Detail"></dd></div>
            <div><dt>สิ่งยึดเหนี่ยว:</dt><dd data-field="Belief_Anchor"></dd></div>
            <div class="md:col-span-2"><dt>สิ่งยึดเหนี่ยว (ระบุ):</dt><dd data-field="Belief_Anchor_Detail"></dd></div>
          </div>
        </fieldset>
        
        <!-- 12. การมีส่วนร่วม -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">12. การมีส่วนร่วม</legend>
          <div class="preview-grid mt-2">
            <div><dt>สถานะ:</dt><dd data-field="Partic_Status"></dd></div>
            <div class="col-span-full"><dt>ไม่ต้องการ (เนื่องจาก):</dt><dd data-field="Partic_No_Detail"></dd></div>
            <div class="col-span-full"><dt>ต้องการ (Checkbox):</dt><dd id="preview-partic-details"></dd></div>
            <div class="col-span-full"><dt>ต้องการ (อื่นๆ):</dt><dd data-field="Partic_Want_Other"></dd></div>
          </div>
        </fieldset>

        <!-- 13. Pain -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">13. PAIN MANAGEMENT</legend>
          <div class="preview-grid mt-2">
            <div><dt>สถานะปวด:</dt><dd data-field="Pain_Status"></dd></div>
            <div class="md:col-span-2"><dt>บริเวณ:</dt><dd data-field="Pain_Location"></dd></div>
            <div><dt>สาเหตุ:</dt><dd data-field="Pain_Cause"></dd></div>
            <div><dt>ลักษณะ:</dt><dd data-field="Pain_Pattern"></dd></div>
            <div class="md:col-span-2"><dt>ลักษณะ (อื่นๆ):</dt><dd data-field="Pain_Pattern_Other"></dd></div>
            <div><dt>Scale (Numeric):</dt><dd data-field="Pain_Scale_Score"></dd></div>
            <div class="md:col-span-2"><dt>Scale (Face):</dt><dd data-field="Pain_Scale_Face"></dd></div>
            <div class="col-span-full"><dt>กระทบต่อ:</dt><dd id="preview-pain-effect"></dd></div>
            <div class="col-span-full"><dt>สิ่งที่บรรเทา:</dt><dd id="preview-pain-relief"></dd></div>
          </div>
        </fieldset>
        
        <!-- 14. Braden -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">14. Braden Scale</legend>
          <div class="preview-grid mt-2">
            <div><dt>การรับรู้:</dt><dd data-field="Braden_Sensory"></dd></div>
            <div><dt>ความเปียกชื้น:</dt><dd data-field="Braden_Moisture"></dd></div>
            <div><dt>กิจกรรม:</dt><dd data-field="Braden_Activity"></dd></div>
            <div><dt>การเคลื่อนไหว:</dt><dd data-field="Braden_Mobility"></dd></div>
            <div><dt>โภชนาการ:</dt><dd data-field="Braden_Nutrition"></dd></div>
            <div><dt>การเสียดสี:</dt><dd data-field="Braden_Friction"></dd></div>
            <div class="md:col-span-2"><dt>คะแนนรวม (Total):</dt><dd data-field="Braden_Total" class="font-bold text-blue-700"></dd></div>
            <div><dt>แปลผล:</dt><dd data-field="Braden_Result"></dd></div>
          </div>
        </fieldset>

        <!-- 15. Fall Risk -->
        <fieldset class="border p-4 rounded-lg">
          <legend class="text-lg font-semibold px-2">15. Fall risk assessment</legend>
          <div class="preview-grid preview-grid-4 mt-2">
            <div><dt>วัยเด็ก:</dt><dd data-field="Fall_Age_Child"></dd></div>
            <div><dt>ผู้สูงอายุ >65:</dt><dd data-field="Fall_Age_Elder"></dd></div>
            <div><dt>สภาวะทางจิต:</dt><dd data-field="Fall_Mental"></dd></div>
            <div><dt>ประวัติหกล้ม:</dt><dd data-field="Fall_History"></dd></div>
            <div><dt>ใช้ยา:</dt><dd data-field="Fall_Meds"></dd></div>
            <div><dt>การมองเห็น:</dt><dd data-field="Fall_Vision"></dd></div>
            <div><dt>การเดิน/ทรงตัว:</dt><dd data-field="Fall_Gait"></dd></div>
            <div><dt>ผลลัพธ์:</dt><dd data-field="Fall_Result"></dd></div>
          </div>
        </fieldset>
             
             <!-- ===== ผู้ประเมิน ===== -->
            <fieldset class="border p-4 rounded-lg shadow-sm bg-gray-50">
              <legend class="text-lg font-semibold px-2 text-gray-800">ผู้ประเมิน</legend>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700">ลงชื่อผู้ประเมิน</label>
                  <select id="assessor-name" name="Assessor_Name" class="mt-1 p-2 block w-full border rounded-md">
                    <option value="">-- กรุณาเลือก --</option>
                    <!-- (จะถูกเติมโดย script.js) -->
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700">ตำแหน่ง</label>
                  <input type="text" id="assessor-position" name="Assessor_Position" class="mt-1 p-2 block w-full border rounded-md bg-gray-200" readonly>
                </div>
              </div>
            </fieldset>

          </div>
          
          <!-- Footer ใน Form -->
          <div class="mt-12 pt-6 border-t flex justify-end">
              <button id="close-assessment-modal-btn-bottom" type="button" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg mr-3">
                ปิด
              </button>
              <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow">
                บันทึกข้อมูล
              </button>
          </div>
        </div>
      </form>
    </div>

    <!-- (Modal: Classification) -->
    <div id="classify-modal" class="fixed inset-0 bg-white z-50 hidden overflow-y-auto">
      <form id="classify-form">
        <!-- Modal Header (Sticky) -->
        <div class="sticky top-0 bg-white shadow-md z-10">
          <div class="container mx-auto px-6 py-4">
            <div class="flex flex-col md:flex-row justify-between md:items-center">
              <div>
                <h3 class="text-2xl font-bold text-teal-800">แบบบันทึกการจำแนกประเภทผู้ป่วย</h3>
                <p class="text-gray-600">AN: <strong id="classify-an-display" class="text-teal-700"></strong> | ชื่อ: <strong id="classify-name-display" class="text-teal-700"></strong></p>
              </div>
              <div class="mt-3 md:mt-0 flex items-center space-x-3">
                <!-- Paging Control -->
                <div class="flex items-center space-x-2">
                  <button id="classify-prev-page-btn" type="button" class="px-3 py-2 bg-gray-200 hover:bg-gray-300 rounded-md">&lt;</button>
                  <span class="text-lg font-semibold">หน้า <span id="classify-page-display">1</span></span>
                  <button id="classify-next-page-btn" type="button" class="px-3 py-2 bg-gray-200 hover:bg-gray-300 rounded-md">&gt;</button>
                  <button id="classify-add-page-btn" type="button" class="px-3 py-2 bg-green-500 text-white hover:bg-green-600 rounded-md">+</button>
                </div>
                <button id="close-classify-modal-btn" type="button" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg">
                  ปิด
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Modal Body (Scrollable Table) -->
        <div class="container mx-auto px-6 py-8">
          <div class="overflow-x-auto">
            <table id="classify-table" class="w-full min-w-[1200px] border-collapse">
              <thead>
                <!-- (ส่วนหัวตารางจะถูกสร้างโดย JS) -->
              </thead>
              <tbody id="classify-table-body">
                <!-- (8 หมวดประเมิน + สรุป จะถูกสร้างโดย JS) -->
              </tbody>
            </table>
          </div>
         </div>
      </form>
    </div>

    <!-- (Modal: Focus Problem FR-IPD-005) -->
    <div id="focus-problem-modal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-start pt-16 z-50 hidden overflow-y-auto">
      <div class="bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[85vh] m-4">
        <form id="focus-problem-form">
          <div class="flex justify-between items-center p-4 border-b">
            <h3 id="focus-modal-title" class="text-xl font-semibold text-gray-800">เพิ่มรายการปัญหาสุขภาพ</h3>
            <button id="close-focus-modal-btn" type="button" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
          </div>
          
          <input type="hidden" id="focus-entry-id" name="Entry_ID">
          
          <div class="p-6 overflow-y-auto max-h-[calc(85vh-200px)] space-y-6">
            
            <fieldset class="border p-4 rounded-lg">
              <legend class="text-lg font-semibold px-2">ปัญหา (FOCUS / PROBLEM)</legend>
            
              <div class="mt-2">
                <label for="focus-template-search" class="block text-sm font-medium text-gray-700">ค้นหาจากเทมเพลต</label>
                <div class="flex items-center space-x-2">
                  <input type="text" id="focus-template-search" list="focus-template-datalist" 
                         class="mt-1 p-2 block w-full border rounded-md bg-gray-50" 
                         placeholder="พิมพ์คำค้นหา... (เช่น เสี่ยงต่อ...)" autocomplete="off">
                  <datalist id="focus-template-datalist"></datalist>
                  
                  <button type="button" id="open-template-modal-btn" class="mt-1 px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 font-bold" title="เพิ่มเทมเพลตใหม่">+</button>
                </div>
            
                <label for="focus-problem-text" class="block text-sm font-medium text-gray-700 mt-4">พิมพ์/แก้ไข ปัญหา</label>
                <textarea id="focus-problem-text" name="Problem" rows="4" class="mt-1 p-2 block w-full border rounded-md" required></textarea>
              </div>
            </fieldset>
            
            <fieldset class="border p-4 rounded-lg">
              <legend class="text-lg font-semibold px-2">เป้าหมาย (Goal/Outcome)</legend>
              <div class="mt-2">
                <label for="focus-goal-text" class="block text-sm font-medium text-gray-700">พิมพ์/แก้ไข เป้าหมาย</label>
                <textarea id="focus-goal-text" name="Goal" rows="4" class="mt-1 p-2 block w-full border rounded-md"></textarea>
              </div>
            </fieldset>

                     
            <fieldset class="border p-4 rounded-lg">
              <legend class="text-lg font-semibold px-2">วันที่</legend>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                <div>
                  <label for="focus-active-date" class="block text-sm font-medium text-gray-700">วันที่พบปัญหา (Active)</label>
                  <input type="date" id="focus-active-date" name="ActiveDate" class="mt-1 p-2 block w-full border rounded-md" required>
                </div>
                <div>
                  <label for="focus-resolved-date" class="block text-sm font-medium text-gray-700">วันที่สิ้นสุดปัญหา (Resolved)</label>
                  <input type="date" id="focus-resolved-date" name="ResolvedDate" class="mt-1 p-2 block w-full border rounded-md">
                </div>
              </div>
            </fieldset>

          </div>
          
          <div class="flex justify-end items-center p-4 border-t bg-gray-50 rounded-b-lg">
            <button id="cancel-focus-btn" type="button" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg mr-3">
              ยกเลิก
            </button>
            <button type="submit" form="focus-problem-form" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow">
              บันทึกปัญหา
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- (Modal: Add Template FR-IPD-005) -->
    <div id="add-template-modal" class="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-60 hidden">
      <div class="bg-white rounded-lg shadow-xl w-full max-w-lg m-4">
        <form id="add-template-form">
          <div class="flex justify-between items-center p-4 border-b">
            <h3 class="text-xl font-semibold text-gray-800">สร้างเทมเพลตปัญหาใหม่</h3>
            <button id="close-template-modal-btn" type="button" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
          </div>
          
          <div class="p-6 space-y-4">
            <div>
              <label for="template-name" class="block text-sm font-medium text-gray-700 font-bold text-blue-600">ชื่อเรียก/คำค้นหา (Template Name)</label>
              <input type="text" id="template-name" name="Name" class="mt-1 p-2 block w-full border rounded-md" required placeholder="เช่น: ติดเชื้อ, เสี่ยงตกเตียง, Pain">
            </div>
            
            <div>
              <label for="template-problem-text" class="block text-sm font-medium text-gray-700">รายละเอียดปัญหา (Full Problem Text)</label>
              <textarea id="template-problem-text" name="Problem" rows="3" class="mt-1 p-2 block w-full border rounded-md" required placeholder="ข้อความยาวๆ..."></textarea>
            </div>
            <div>
              <label for="template-goal-text" class="block text-sm font-medium text-gray-700">เป้าหมาย (Goal)</label>
              <textarea id="template-goal-text" name="Goal" rows="3" class="mt-1 p-2 block w-full border rounded-md" placeholder="เป้าหมาย..."></textarea>
            </div>
          </div>
          
          <div class="flex justify-end items-center p-4 border-t bg-gray-50 rounded-b-lg">
            <button id="cancel-template-modal-btn" type="button" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg mr-3">ยกเลิก</button>
            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow">บันทึกเทมเพลต</button>
          </div>
        </form>
      </div>
    </div>

    <!-- (FR-IPD-006) -->
    <div id="progress-note-modal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-start pt-10 z-50 hidden overflow-y-auto">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] m-4 flex flex-col">
          
          <div class="flex justify-between items-center p-4 border-b bg-indigo-50 rounded-t-lg">
            <div>
              <h3 class="text-xl font-bold text-indigo-800">บันทึกความก้าวหน้าทางการพยาบาล Nursing Progress Note (FR-IPD-006)</h3>
              <p class="text-sm text-gray-600">AN: <span id="prog-an-display"></span> | ชื่อ: <span id="prog-name-display"></span></p>
            </div>
            <div class="flex gap-2">
              <button id="re-progress-btn" type="button" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-lg shadow flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" /></svg>
                Re-Progress
              </button>
              <button id="close-progress-modal-btn" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
            </div>
          </div>
      
          <form id="progress-note-form" class="p-6 overflow-y-auto flex-1">
            <input type="hidden" name="Entry_ID" id="prog-entry-id">
            
            <div class="grid grid-cols-1 md:grid-cols-12 gap-4 mb-4 bg-gray-50 p-4 rounded border">
              <div class="md:col-span-3">
                <label class="block text-sm font-semibold text-gray-700">วันที่</label>
                <input type="date" name="Date" id="prog-date" class="mt-1 p-2 w-full border rounded" required>
              </div>
              <div class="md:col-span-3">
                 <label class="block text-sm font-semibold text-gray-700">เวลา</label>
                 <input type="time" name="Time" id="prog-time" class="mt-1 p-2 w-full border rounded" required>
              </div>
              <div class="md:col-span-6">
                 <label class="block text-sm font-semibold text-gray-700">เวร (Shift)</label>
                 <div class="flex gap-4 mt-2">
                   <label><input type="radio" name="Shift" value="ดึก (00-08)" required> ดึก (00-08)</label>
                   <label><input type="radio" name="Shift" value="เช้า (08-16)"> เช้า (08-16)</label>
                   <label><input type="radio" name="Shift" value="บ่าย (16-24)"> บ่าย (16-24)</label>
                 </div>
              </div>
              
              <div class="md:col-span-12 border-t pt-4 mt-2">
                 <label class="block text-sm font-bold text-blue-700">ค้นหาจากชื่อเทมเพลต (Template)</label>
                 <div class="flex gap-2">
                   <input type="text" id="prog-template-search" list="prog-template-list" class="mt-1 p-2 w-full border rounded bg-white shadow-sm" placeholder="พิมพ์ชื่อโรค/อาการ... (เช่น ไข้สูง, Pain, Sepsis)">
                   <datalist id="prog-template-list"></datalist>
                   <button type="button" id="save-as-template-btn" class="mt-1 bg-teal-500 text-white px-4 rounded hover:bg-teal-600 whitespace-nowrap">+ สร้าง Template</button>
                 </div>
              </div>
            </div>
      
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-bold text-gray-800 bg-gray-200 p-2 rounded-t">FOCUS/PROBLEM</label>
                <input type="text" name="Focus" id="prog-focus" class="w-full p-3 border border-t-0 rounded-b focus:ring-2 focus:ring-blue-500" placeholder="ระบุปัญหาทางการพยาบาล...">
              </div>
      
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-bold text-red-700">S: Subjective Data</label>
                  <textarea name="S_Data" id="prog-s" rows="3" class="w-full p-2 border rounded mt-1" placeholder="ข้อมูลจากคำบอกเล่า..."></textarea>
                </div>
                <div>
                  <label class="block text-sm font-bold text-blue-700">O: Objective Data</label>
                  <textarea name="O_Data" id="prog-o" rows="3" class="w-full p-2 border rounded mt-1" placeholder="ผลตรวจ, V/S, สิ่งที่สังเกตเห็น..."></textarea>
                </div>
                <div>
                  <label class="block text-sm font-bold text-green-700">I: Intervention</label>
                  <textarea name="I_Data" id="prog-i" rows="5" class="w-full p-2 border rounded mt-1" placeholder="กิจกรรมการพยาบาล..."></textarea>
                </div>
                <div class="col-span-1">
                  <div class="flex justify-between items-end mb-1">
                    <label class="block text-sm font-bold text-purple-700">E: Evaluation</label>
                    <div class="flex items-center gap-1">
                       <span class="text-xs text-gray-500">เวลาประเมิน:</span>
                       <input type="time" name="E_Time" id="prog-e-time" class="p-1 border rounded text-sm bg-purple-50">
                    </div>
                  </div>
                  <textarea name="E_Data" id="prog-e" rows="5" class="w-full p-2 border rounded" placeholder="ผลลัพธ์ทางการพยาบาล..."></textarea>
                </div>
              </div>
            </div>
      
            <div class="mt-6 pt-4 border-t grid grid-cols-1 md:grid-cols-2 gap-4 items-center">
              <div>
                <label class="block text-sm font-semibold text-gray-700">พยาบาลผู้บันทึก</label>
                <input type="text" name="Nurse_Name" list="staff-list-datalist" class="mt-1 p-2 w-full border rounded" placeholder="ค้นหาชื่อ..." required>
              </div>
              <div class="text-right mt-6">
                <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-8 rounded-lg shadow-lg text-lg">
                  บันทึกข้อมูล (Save)
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    <div id="add-progress-template-modal" class="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-start pt-10 z-[60] hidden overflow-y-auto">
      <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl m-4">
        <form id="add-progress-template-form">
          <div class="flex justify-between items-center p-4 border-b bg-green-50 rounded-t-lg">
            <h3 class="text-xl font-bold text-green-800">สร้าง/แก้ไข เทมเพลต (FR-IPD-006)</h3>
            <button id="close-prog-temp-modal-btn" type="button" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
          </div>
          
          <div class="p-6 space-y-4">
            <div class="bg-yellow-50 p-4 rounded border border-yellow-200">
              <label class="block text-sm font-bold text-blue-700 mb-1">ชื่อเทมเพลต (Keyword สำหรับค้นหา) *</label>
              <input type="text" name="TemplateName" id="temp-name-input" class="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 font-bold" placeholder="เช่น: ไข้สูง, Pain, Sepsis, ใส่สายสวนปัสสาวะ" required>
            </div>

            <div>
              <label class="block text-sm font-bold text-gray-700">FOCUS / PROBLEM</label>
              <input type="text" name="Focus" id="temp-focus-input" class="w-full p-2 border rounded focus:ring-2 focus:ring-green-500" placeholder="ระบุปัญหา...">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-bold text-red-700">S: Subjective Data</label>
                <textarea name="S_Data" id="temp-s-input" rows="3" class="w-full p-2 border rounded mt-1"></textarea>
              </div>
              <div>
                <label class="block text-sm font-bold text-blue-700">O: Objective Data</label>
                <textarea name="O_Data" id="temp-o-input" rows="3" class="w-full p-2 border rounded mt-1"></textarea>
              </div>
              <div>
                <label class="block text-sm font-bold text-green-700">I: Intervention</label>
                <textarea name="I_Data" id="temp-i-input" rows="4" class="w-full p-2 border rounded mt-1"></textarea>
              </div>
              <div>
                <label class="block text-sm font-bold text-purple-700">E: Evaluation</label>
                <textarea name="E_Data" id="temp-e-input" rows="4" class="w-full p-2 border rounded mt-1"></textarea>
              </div>
            </div>
          </div>
          
          <div class="flex justify-end items-center p-4 border-t bg-gray-50 rounded-b-lg">
            <button id="cancel-prog-temp-btn" type="button" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg mr-3">ยกเลิก</button>
            <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg shadow text-lg">บันทึกเทมเพลต</button>
          </div>
        </form>
      </div>
    </div>
<!-- (FR-IPD-007) -->
    <div id="discharge-form-modal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-start pt-10 z-50 hidden overflow-y-auto">
      <div class="bg-white rounded-lg shadow-xl w-full max-w-5xl m-4 mb-20">
        <form id="discharge-form">
          <div class="flex justify-between items-center p-4 border-b bg-pink-50 rounded-t-lg">
            <h3 class="text-xl font-bold text-pink-800">แบบบันทึกการพยาบาลผู้ป่วยจำหน่าย (PR-IPD-007)</h3>
            <button id="close-discharge-modal-btn" type="button" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
          </div>
          
          <div class="p-6 space-y-6 text-sm">
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 border-b pb-4">
               <div class="flex items-center gap-2">
                  <label class="font-bold">วันที่จำหน่าย:</label>
                  <input type="date" name="DischargeDate" class="p-1 border rounded">
               </div>
               <div class="flex items-center gap-2">
                  <label class="font-bold">วันที่ออกจาก รพ.:</label>
                  <input type="date" name="LeaveDate" class="p-1 border rounded"> <label>เวลา:</label>
                  <input type="time" name="LeaveTime" class="p-1 border rounded"> น.
               </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 border-b pb-4">
               <div>
                  <label class="font-bold block mb-2">ประเภทการจำหน่าย</label>
                  <div class="grid grid-cols-2 gap-2">
                     <label><input type="checkbox" name="DischargeType" value="แพทย์อนุญาต"> แพทย์อนุญาต</label>
                     <label><input type="checkbox" name="DischargeType" value="ปฏิเสธการรักษา"> ปฏิเสธการรักษา</label>
                     <label><input type="checkbox" name="DischargeType" value="หนีกลับ"> หนีกลับ</label>
                     <label><input type="checkbox" name="DischargeType" value="REFER"> REFER</label>
                     <label><input type="checkbox" name="DischargeType" value="ตาย (ชันสูตร)"> ตาย (ชันสูตร)</label>
                     <label><input type="checkbox" name="DischargeType" value="ตาย (ไม่ชันสูตร)"> ตาย (ไม่ชันสูตร)</label>
                  </div>
               </div>
               <div>
                  <label class="font-bold block mb-2">สภาพการจำหน่าย</label>
                  <div class="flex gap-4">
                     <label><input type="checkbox" name="DischargeStatus" value="หายสนิท"> หายสนิท</label>
                     <label><input type="checkbox" name="DischargeStatus" value="ดีขึ้น"> ดีขึ้น</label>
                     <label><input type="checkbox" name="DischargeStatus" value="ไม่ดีขึ้น"> ไม่ดีขึ้น</label>
                  </div>
               </div>
            </div>

            <fieldset class="border p-3 rounded bg-gray-50">
               <legend class="font-bold px-2">สรุปอาการและอาการแสดงผู้ป่วยก่อนจำหน่าย</legend>
               <div class="flex flex-wrap gap-4 items-center mb-2">
                  <div>BT <input type="text" name="VS_BT" class="w-16 p-1 border rounded text-center"> °C</div>
                  <div>PR <input type="text" name="VS_PR" class="w-16 p-1 border rounded text-center"> /min</div>
                  <div>RR <input type="text" name="VS_RR" class="w-16 p-1 border rounded text-center"> /min</div>
                  <div>BP <input type="text" name="VS_BP" class="w-24 p-1 border rounded text-center"> mmHg</div>
                  <div>อื่นๆ <input type="text" name="VS_Other" class="w-32 p-1 border rounded"></div>
               </div>
               <div class="flex items-center gap-2">
                  <label>อาการและอาการแสดง:</label>
                  <input type="text" name="Symp_Before_Discharge" class="flex-1 p-1 border rounded">
               </div>
            </fieldset>

            <fieldset class="border p-4 rounded">
               <legend class="font-bold text-blue-700 px-2 text-lg">การสอนสุขศึกษา / คำแนะนำ / D-METHOD</legend>
               
               <div class="space-y-3">
                  <div>
                     <div class="font-bold text-red-700 mb-1">1. D (Disease) ความรู้เรื่องโรค อาการผิดปกติที่ควรมาพบแพทย์</div>
                     <div class="flex flex-wrap gap-4 ml-4">
                        <label><input type="checkbox" name="D_Fever"> มีไข้สูง</label>
                        <label><input type="checkbox" name="D_Wound"> แผลบวมแดง มีหนอง</label>
                        <label><input type="checkbox" name="D_Drowsy"> ซึม ความรู้สึกตัวเปลี่ยน</label>
                        <label><input type="checkbox" name="D_Dyspnea"> หายใจหอบมากขึ้น</label>
                        <div class="flex items-center gap-1">
                           <label><input type="checkbox" name="D_Other"> อื่นๆ</label>
                           <input type="text" name="D_Other_Text" class="p-1 border-b border-gray-400 w-48 focus:outline-none">
                        </div>
                     </div>
                  </div>

                  <div>
                      <div class="font-bold text-blue-700 mb-1">2. M (Medication) ความรู้เกี่ยวกับยา ฤทธิ์ยา การใช้ยา ข้อควรระวัง</div>
                      <textarea name="M_Details" rows="4" class="w-full p-2 border rounded ml-4">
                  ได้รับคำแนะนำเรื่อง: ชื่อยา, ฤทธิ์ของยา/วัตถุประสงค์, วิธีใช้ (ขนาด/เวลา), ข้อควรระวัง/ข้อห้าม, การเก็บรักษา และสังเกตอาการแพ้ยา (หากมีผื่น/บวม ให้หยุดยาและพบแพทย์ทันที)
                  </textarea>
                  </div>

                  <div>
                     <div class="font-bold mb-1">3. E (Environment)</div>
                     <div class="flex gap-4 ml-4">
                        <label><input type="checkbox" name="E_Clean"> จัดสิ่งแวดล้อมสะอาด อากาศถ่ายเท</label>
                        <div class="flex items-center gap-1">
                           <label><input type="checkbox" name="E_Other"> อื่นๆ</label>
                           <input type="text" name="E_Other_Text" class="p-1 border-b border-gray-400 w-48 focus:outline-none">
                        </div>
                     </div>
                  </div>

                  <div>
                     <div class="font-bold mb-1">4. T (Treatment) แนะนำเรื่อง</div>
                     <div class="flex gap-4 ml-4">
                        <label><input type="checkbox" name="T_CleanBody"> การทำความสะอาดร่างกาย</label>
                        <label><input type="checkbox" name="T_WoundCare"> การทำแผล</label>
                        <div class="flex items-center gap-1">
                           <label><input type="checkbox" name="T_Other"> อื่นๆ</label>
                           <input type="text" name="T_Other_Text" class="p-1 border-b border-gray-400 w-48 focus:outline-none">
                        </div>
                     </div>
                  </div>

                  <div>
                     <div class="font-bold mb-1">5. H (Health) แนะนำออกกำลังกาย/พักผ่อน</div>
                     <div class="flex gap-4 ml-4">
                        <label><input type="checkbox" name="H_Exercise"> แนะนำการออกกำลังกาย/พักผ่อน</label>
                        <div class="flex items-center gap-1">
                           <label><input type="checkbox" name="H_Other"> อื่นๆ</label>
                           <input type="text" name="H_Other_Text" class="p-1 border-b border-gray-400 w-48 focus:outline-none">
                        </div>
                     </div>
                  </div>

                  <div>
                      <div class="font-bold mb-1">6. O (Outpatient refer) การมาตรวจตามนัด/แหล่งประโยชน์/1669</div>
                      <div class="ml-4">
                          <textarea name="O_Refer" rows="3" class="w-full p-2 border rounded">เน้นย้ำมาตรวจตามนัด แนะนำแหล่งประโยชน์ใกล้บ้าน และโทร 1669 กรณีมีอาการผิดปกติฉุกเฉิน</textarea>
                      </div>
                  </div>

                  <div>
                     <div class="font-bold text-green-700 mb-1">7. D (Diet) อาหารที่เหมาะสม มีประโยชน์</div>
                     <div class="grid grid-cols-2 md:grid-cols-4 gap-2 ml-4">
                        <label><input type="checkbox" name="D_Diet_5Group"> ครบ 5 หมู่</label>
                        <label><input type="checkbox" name="D_Diet_Soft"> อ่อน</label>
                        <label><input type="checkbox" name="D_Diet_Cooked"> สุกสะอาด</label>
                        <label><input type="checkbox" name="D_Diet_Protein"> เนื้อ นม ไข่ ผัก ผลไม้</label>
                        <label><input type="checkbox" name="D_Diet_AvoidFat"> เลี่ยงไขมันสูง</label>
                        <label><input type="checkbox" name="D_Diet_NoVeg"> งดผักผลไม้</label>
                        <div class="col-span-2 flex items-center gap-1">
                           <label><input type="checkbox" name="D_Diet_Other"> อื่นๆ</label>
                           <input type="text" name="D_Diet_Other_Text" class="p-1 border-b border-gray-400 w-full focus:outline-none">
                        </div>
                     </div>
                  </div>
               </div>
            </fieldset>

            <div class="border-t pt-4">
               <div class="flex flex-wrap items-center gap-4">
                  <label class="font-bold">ยา / เวชภัณฑ์ / อุปกรณ์กลับบ้าน:</label>
                  <label><input type="radio" name="Supplies_Status" value="ได้ครบ"> ได้ครบ</label>
                  <label><input type="radio" name="Supplies_Status" value="ได้ไม่ครบ"> ได้ไม่ครบ</label>
                  <div class="flex items-center gap-1">
                     <span class="text-gray-600">ระบุ:</span>
                     <input type="text" name="Supplies_Note" class="p-1 border-b border-gray-400 w-64 focus:outline-none">
                  </div>
               </div>
            </div>

            <fieldset class="border p-3 rounded bg-yellow-50">
               <legend class="font-bold px-2 text-yellow-800">ปัญหาที่ต้องดูแลต่อเนื่อง</legend>
               <div class="space-y-2">
                  <label><input type="checkbox" name="FU_No"> ไม่มี F/U</label>
                  <div class="flex items-center gap-2">
                     <label><input type="checkbox" name="FU_Yes"> มีนัด F/U</label>
                     <input type="text" name="FU_Date" class="flex-1 p-1 border-b border-gray-400 bg-transparent focus:outline-none" placeholder="ระบุวัน/รายละเอียด...">
                  </div>
                  <label><input type="checkbox" name="Care_Wound"> ล้างแผลสถานพยาบาลใกล้บ้านทุกวัน</label>
                  <div class="flex items-center gap-2">
                     <label><input type="checkbox" name="Care_Stitch"> ตัดไหมสถานพยาบาลใกล้บ้าน วันที่</label>
                     <input type="date" name="Care_Stitch_Date" class="p-1 border rounded">
                  </div>
                  <div class="flex items-center gap-2">
                     <label><input type="checkbox" name="Care_Other"> อื่นๆ</label>
                     <input type="text" name="Care_Other_Text" class="flex-1 p-1 border-b border-gray-400 bg-transparent focus:outline-none">
                  </div>
               </div>
            </fieldset>

            <div class="border-t pt-4">
               <div class="font-bold mb-2">สถานที่รับการดูแลต่อ:</div>
               <div class="flex flex-wrap gap-4 mb-4">
                  <div class="flex items-center gap-1"><label><input type="checkbox" name="Dest_Center"> รพ.ศ.</label> <input type="text" name="Dest_Center_Text" class="w-20 border-b border-gray-400"></div>
                  <div class="flex items-center gap-1"><label><input type="checkbox" name="Dest_General"> รพ.ท.</label> <input type="text" name="Dest_General_Text" class="w-20 border-b border-gray-400"></div>
                  <div class="flex items-center gap-1"><label><input type="checkbox" name="Dest_Community"> รพ.ช.</label> <input type="text" name="Dest_Community_Text" class="w-20 border-b border-gray-400"></div>
                  <div class="flex items-center gap-1"><label><input type="checkbox" name="Dest_HealthCenter"> รพ.สต.</label> <input type="text" name="Dest_HealthCenter_Text" class="w-20 border-b border-gray-400"></div>
                  <div class="flex items-center gap-1"><label><input type="checkbox" name="Dest_Other"> อื่นๆ</label> <input type="text" name="Dest_Other_Text" class="w-32 border-b border-gray-400"></div>
               </div>

               <div class="flex flex-wrap gap-4 items-center mb-4">
                  <label class="font-bold">ชื่อผู้รับผู้ป่วยกลับ:</label>
                  <input type="text" name="Pickup_Name" class="p-1 border rounded w-48">
                  <label>เกี่ยวข้องเป็น:</label>
                  <input type="text" name="Pickup_Rel" class="p-1 border rounded w-32">
               </div>
            </div>

            <div class="pt-4 border-t bg-gray-100 p-3 rounded">
                <div class="flex flex-wrap gap-4 items-center">
                   <label class="font-bold text-indigo-700">พยาบาลผู้จำหน่าย:</label>
                   <input type="text" name="Nurse_Name" list="staff-list-datalist" class="p-2 border rounded w-64" placeholder="ค้นหาชื่อ..." required>
                   <label>ตำแหน่ง:</label>
                   <input type="text" name="Nurse_Pos" class="p-2 border rounded w-48 bg-white" readonly> </div>
            </div>

          </div>
          
          <div class="flex justify-end items-center p-4 border-t bg-gray-50 rounded-b-lg">
             <button type="submit" class="bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-8 rounded-lg shadow text-lg">บันทึก (Save)</button>
          </div>
        </form>
      </div>
    </div>

    <!-- (Discharge Plan) -->
    <div id="advice-form-modal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-start pt-10 z-50 hidden overflow-y-auto">
  <div class="bg-white rounded-lg shadow-xl w-full max-w-6xl m-4 mb-20">
    <form id="advice-form">
      <div class="flex justify-between items-center p-4 border-b bg-teal-50 rounded-t-lg">
        <h3 class="text-xl font-bold text-teal-800">การให้คำแนะนำการปฏิบัติตัวระหว่างเข้ารับการรักษาในโรงพยาบาลและเมื่อผู้ป่วยกลับบ้าน (Discharge Plan)</h3>
        <button id="close-advice-modal-btn" type="button" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
      </div>
      
      <div class="p-6 space-y-4 text-sm overflow-x-auto">
        <table class="w-full border-collapse border border-gray-300 min-w-[900px]">
          <thead class="bg-gray-100">
             <tr>
               <th class="border p-2 text-center w-1/6">เรื่อง</th>
               <th class="border p-2 text-center">คำแนะนำ</th>
               <th class="border p-2 text-center w-32">วันที่ให้</th>
               <th class="border p-2 text-center w-32">ผู้ให้</th>
               <th class="border p-2 text-center w-32">ผู้รับ</th>
             </tr>
          </thead>
          <tbody>
             <tr>
               <td class="border p-2 font-bold align-top">D=Diagnosis<br>การให้ความรู้เรื่องโรค</td>
               <td class="border p-2 align-top">
                  <label class="block mb-1">ให้ความรู้เรื่องโรคที่เป็นอยู่ถึงสาเหตุ อาการ การปฏิบัติตัว ระบุ:</label>
                  <textarea name="D_Detail" rows="3" class="w-full p-1 border rounded"></textarea>
               </td>
               <td class="border p-2 align-top"><input type="date" name="D_Date" class="w-full border rounded p-1"></td>
               <td class="border p-2 align-top"><input type="text" name="D_Giver" class="w-full border rounded p-1"></td>
               <td class="border p-2 align-top"><input type="text" name="D_Receiver" class="w-full border rounded p-1"></td>
             </tr>
             <tr>
               <td class="border p-2 font-bold align-top">M=Medicine<br>การให้ความรู้เรื่องยา</td>
               <td class="border p-2 align-top space-y-2">
                  <div class="flex gap-2 items-center"><label>ชนิดของยา:</label><input type="text" name="M_Detail" class="flex-1 border rounded p-1"></div>
                  <div class="flex gap-2 items-center"><label>ฤทธิ์ของยา / ผลข้างเคียง:</label><input type="text" name="M_SideEffect" class="flex-1 border rounded p-1"></div>
               </td>
               <td class="border p-2 align-top"><input type="date" name="M_Date" class="w-full border rounded p-1"></td>
               <td class="border p-2 align-top"><input type="text" name="M_Giver" class="w-full border rounded p-1"></td>
               <td class="border p-2 align-top"><input type="text" name="M_Receiver" class="w-full border rounded p-1"></td>
             </tr>
             <tr>
                <td class="border p-2 font-bold align-top">E=Environment & Economic</td>
                <td class="border p-2 align-top">
                   <div class="font-bold">- การดำรงชีวิตที่เหมาะสมกับสภาวะของโรค</div>
                   <div class="ml-4 grid grid-cols-1 md:grid-cols-2 gap-1 mb-2">
                      <label><input type="checkbox" name="E_Nutrition"> การจัดการโภชนาการที่เหมาะสม</label>
                      <label><input type="checkbox" name="E_Exercise"> การออกกำลังกายที่สม่ำเสมอ</label>
                      <label><input type="checkbox" name="E_Meds"> การใช้ยาและการปฏิบัติตามแผนการรักษา</label>
                      <label><input type="checkbox" name="E_Stress"> การจัดการอารมณ์และความเครียด</label>
                      <label class="col-span-2"><input type="checkbox" name="E_Complication"> การป้องกันภาวะแทรกซ้อนและการดูแลตนเอง</label>
                   </div>
                   <div class="font-bold">- ผู้ป่วยจำเป็นที่จะต้องได้รับการดูแลช่วยเหลือในเรื่อง</div>
                   <div class="ml-4 grid grid-cols-1 gap-1">
                      <label><input type="checkbox" name="E_Support"> การสนับสนุนการมีส่วนร่วมของครอบครัวในการดูแลผู้ป่วย</label>
                      <label><input type="checkbox" name="E_Economic"> การช่วยเหลือด้านสภาวะเศรษฐกิจ ปัญหาด้านสิทธิ์การรักษา</label>
                   </div>
                </td>
                <td class="border p-2 align-top"><input type="date" name="E_Date" class="w-full border rounded p-1"></td>
                <td class="border p-2 align-top"><input type="text" name="E_Giver" class="w-full border rounded p-1"></td>
                <td class="border p-2 align-top"><input type="text" name="E_Receiver" class="w-full border rounded p-1"></td>
             </tr>
             <tr>
                <td class="border p-2 font-bold align-top">T=Treatment<br>แนวทางการรักษาพยาบาล</td>
                <td class="border p-2 align-top">
                   <div class="font-bold">- แนวทางการรักษาพยาบาล</div>
                   <div class="ml-4 flex flex-wrap gap-3 mb-2">
                      <label><input type="checkbox" name="T_MedTreatment"> การรักษาด้วยยา</label>
                      <label><input type="checkbox" name="T_IV"> การให้สารน้ำ</label>
                      <label><input type="checkbox" name="T_Blood"> ให้เลือด</label>
                      <div class="flex items-center gap-1"><label><input type="checkbox" name="T_Surgery"> การผ่าตัด/หัตถการ ระบุ</label><input type="text" name="T_Surgery_Text" class="border-b border-gray-300 w-24 focus:outline-none"></div>
                      <div class="flex items-center gap-1"><label><input type="checkbox" name="T_Other"> อื่นๆ ระบุ</label><input type="text" name="T_Other_Text" class="border-b border-gray-300 w-24 focus:outline-none"></div>
                   </div>
                   <div class="font-bold">- สาธิตวิธีการดูแลตนเองในเรื่อง</div>
                   <div class="ml-4 flex flex-wrap gap-3 mb-2">
                      <label><input type="checkbox" name="T_TubeFeeding"> การให้อาหารทางสายยาง</label>
                      <label><input type="checkbox" name="T_WoundCare"> การดูแลแผล</label>
                      <div class="flex items-center gap-1"><label><input type="checkbox" name="T_SelfCare_Other"> อื่นๆ ระบุ</label><input type="text" name="T_SelfCare_Other_Text" class="border-b border-gray-300 w-24 focus:outline-none"></div>
                   </div>
                   <div class="font-bold">- ความสำคัญในการดูแลสุขภาพและการปฏิบัติตัวที่ถูกต้อง</div>
                   <div class="ml-4 grid grid-cols-1 gap-1">
                      <label><input type="checkbox" name="T_CorrectMeds"> รับประทานยาให้ถูกขนาด ถูกเวลา และต่อเนื่อง</label>
                      <label><input type="checkbox" name="T_ControlDiet"> ควบคุมและเลือกทานอาหารตามคำแนะนำเฉพาะโรค</label>
                      <label><input type="checkbox" name="T_ExerciseRegular"> ออกกำลังกายอย่างสม่ำเสมอและเหมาะสมกับสภาพร่างกาย</label>
                      <label><input type="checkbox" name="T_Monitor"> ตรวจวัด น้ำตาล ความดัน และ สังเกตอาการผิดปกติ</label>
                      <label><input type="checkbox" name="T_NoSmoke"> งด การสูบบุหรี่ และเครื่องดื่มแอลกอฮอล์ทุกชนิด</label>
                      <label><input type="checkbox" name="T_ObserveWound"> สังเกตและ ดูแลบาดแผลหรืออาการผิดปกติ</label>
                   </div>
                </td>
                <td class="border p-2 align-top"><input type="date" name="T_Date" class="w-full border rounded p-1"></td>
                <td class="border p-2 align-top"><input type="text" name="T_Giver" class="w-full border rounded p-1"></td>
                <td class="border p-2 align-top"><input type="text" name="T_Receiver" class="w-full border rounded p-1"></td>
             </tr>
             <tr>
                <td class="border p-2 font-bold align-top">H=Health</td>
                <td class="border p-2 align-top">
                   <div class="font-bold">- ความรู้เรื่องการลดปัจจัยเสี่ยงต่อการเกิดโรคของผู้ป่วย</div>
                   <div class="ml-4 grid grid-cols-1 md:grid-cols-2 gap-1 mb-2">
                      <label><input type="checkbox" name="H_DietControl"> ควบคุมอาหารตามหลักโภชนาการ</label>
                      <label><input type="checkbox" name="H_Exercise"> ออกกำลังกายสม่ำเสมอ</label>
                      <label><input type="checkbox" name="H_NoSmoke"> งด การสูบบุหรี่ และเครื่องดื่มแอลกอฮอล์ทุกชนิด</label>
                      <label><input type="checkbox" name="H_Stress"> จัดการความเครียด/พักผ่อนให้เพียงพอ</label>
                      <label><input type="checkbox" name="H_MedsPlan"> ใช้ยาตามแผนการรักษา อย่างเคร่งครัด</label>
                      <label><input type="checkbox" name="H_Infection"> หลีกเลี่ยงความเสี่ยงต่อการติดเชื้อ</label>
                   </div>
                   <div class="font-bold">- Empowerment การดูแลสุขภาพที่เหมาะสม เรื่อง</div>
                   <div class="ml-4 flex flex-wrap gap-3">
                      <label><input type="checkbox" name="H_Emp_Knowledge"> ความรู้ที่ถูกต้องเกี่ยวกับโรค</label>
                      <label><input type="checkbox" name="H_Emp_Skill"> ทักษะในการจัดการตนเอง</label>
                      <label><input type="checkbox" name="H_Emp_Goal"> การตั้งเป้าหมายการดูแลสุขภาพ</label>
                   </div>
                </td>
                <td class="border p-2 align-top"><input type="date" name="H_Date" class="w-full border rounded p-1"></td>
                <td class="border p-2 align-top"><input type="text" name="H_Giver" class="w-full border rounded p-1"></td>
                <td class="border p-2 align-top"><input type="text" name="H_Receiver" class="w-full border rounded p-1"></td>
             </tr>
             <tr>
                <td class="border p-2 font-bold align-top">O=Out Patient<br>การดูแลต่อเนื่อง</td>
                <td class="border p-2 align-top space-y-2">
                   <div class="flex flex-wrap items-center gap-2">
                      <label>- การมาตรวจตามนัด วันที่</label><input type="text" name="O_AppointDate" class="border rounded p-1 w-32">
                      <label>สถานที่</label><input type="text" name="O_AppointPlace" class="border rounded p-1 flex-1">
                   </div>
                   <div class="flex items-center gap-2">
                      <label>- การเตรียมตัว</label><input type="text" name="O_Prep" class="flex-1 border rounded p-1">
                   </div>
                   <div>
                      <div class="font-bold">- แหล่งข้อมูลเครือข่ายหรือแหล่งสนับสนุนทางสังคมที่ผู้ป่วยสามารถเข้าถึงบริการ</div>
                      <div class="ml-4 flex flex-wrap gap-3 mt-1">
                         <label><input type="checkbox" name="O_CommunityLeader"> ผู้นำชุมชน</label>
                         <label><input type="checkbox" name="O_Volunteer"> อสม</label>
                         <label><input type="checkbox" name="O_HealthCenter"> รพ.สต.</label>
                         <div class="flex items-center gap-1"><label><input type="checkbox" name="O_SupportOther"> อื่นๆ</label><input type="text" name="O_SupportOther_Text" class="border-b border-gray-300 w-24 focus:outline-none"></div>
                      </div>
                   </div>
                   <div>- การขอความช่วยเหลือ 1669</div>
                </td>
                <td class="border p-2 align-top"><input type="date" name="O_Date" class="w-full border rounded p-1"></td>
                <td class="border p-2 align-top"><input type="text" name="O_Giver" class="w-full border rounded p-1"></td>
                <td class="border p-2 align-top"><input type="text" name="O_Receiver" class="w-full border rounded p-1"></td>
             </tr>
             <tr>
                <td class="border p-2 font-bold align-top">D=Diet<br>การเลือกรับประทานอาหาร</td>
                <td class="border p-2 align-top space-y-2">
                   <div class="font-bold">ความรู้ความเข้าใจด้านอาหารที่เหมาะสม กับสภาวะของโรคและสร้างเสริมสุขภาพ</div>
                   <div class="flex gap-2 items-center"><label>- อาหารเฉพาะโรค ระบุ</label><input type="text" name="D_Diet_Specific" class="flex-1 border rounded p-1"></div>
                   <div class="flex gap-2 items-center"><label>- อาหารที่ควรหลีกเลี่ยง</label><input type="text" name="D_Diet_Avoid" class="flex-1 border rounded p-1"></div>
                   <div class="flex gap-2 items-center"><label>- อื่นๆ</label><input type="text" name="D_Diet_Other" class="flex-1 border rounded p-1"></div>
                </td>
                <td class="border p-2 align-top"><input type="date" name="D_Diet_Date" class="w-full border rounded p-1"></td>
                <td class="border p-2 align-top"><input type="text" name="D_Diet_Giver" class="w-full border rounded p-1"></td>
                <td class="border p-2 align-top"><input type="text" name="D_Diet_Receiver" class="w-full border rounded p-1"></td>
             </tr>
          </tbody>
        </table>
      </div>

      <div class="flex justify-end items-center p-4 border-t bg-gray-50 rounded-b-lg">
         <button type="submit" class="bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-8 rounded-lg shadow text-lg">บันทึก (Save)</button>
      </div>
    </form>
  </div>
</div>
    <div id="morse-modal" class="fixed inset-0 bg-white z-50 hidden overflow-y-auto">
  <div class="sticky top-0 bg-white shadow-md z-10">
    <div class="container mx-auto px-6 py-4">
      <div class="flex flex-col md:flex-row justify-between md:items-center">
        <div>
          <h3 class="text-xl font-bold text-orange-800">แบบประเมินความเสี่ยงต่อการพลัดตกหกล้ม Morse / MAAS</h3>
          <p class="text-gray-600">AN: <strong id="morse-an-display" class="text-orange-700"></strong> | ชื่อ: <strong id="morse-name-display" class="text-orange-700"></strong></p>
        </div>
        <div class="mt-3 md:mt-0 flex items-center space-x-3">
          <div class="flex items-center space-x-2">
            <button id="morse-prev-page-btn" type="button" class="px-3 py-2 bg-gray-200 hover:bg-gray-300 rounded-md">&lt;</button>
            <span class="text-lg font-semibold">หน้า <span id="morse-page-display">1</span></span>
            <button id="morse-next-page-btn" type="button" class="px-3 py-2 bg-gray-200 hover:bg-gray-300 rounded-md">&gt;</button>
            <button id="morse-add-page-btn" type="button" class="px-3 py-2 bg-green-500 text-white hover:bg-green-600 rounded-md">+</button>
          </div>
          <button id="close-morse-modal-btn" type="button" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg">
            ปิด
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <div class="container mx-auto px-6 py-8">
    <div class="overflow-x-auto">
      <form id="morse-form">
        <table id="morse-table" class="w-full min-w-[1200px] border-collapse border border-gray-300 text-sm">
          <thead>
            </thead>
          <tbody id="morse-table-body">
            </tbody>
        </table>
      </form>
    </div>
   </div>
</div>
    <div id="braden-modal" class="fixed inset-0 bg-white z-50 hidden overflow-y-auto">
  <div class="sticky top-0 bg-white shadow-md z-10">
    <div class="container mx-auto px-4 py-3">
      <div class="flex flex-col lg:flex-row justify-between items-center gap-4">
        <div>
          <h3 class="text-xl font-bold text-red-800">แบบบันทึกการพยาบาลเพื่อป้องกันและการดูแลผู้ป่วยที่มีแผลกดทับ</h3>
          <p class="text-sm text-gray-600">AN: <strong id="braden-an-display"></strong> | ชื่อ: <strong id="braden-name-display"></strong></p>
        </div>
        
        <div class="flex items-center gap-2">
           <button id="braden-prev-page" class="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded">&lt;</button>
           <span class="font-bold">ชุดที่ <span id="braden-page-display">1</span></span>
           <button id="braden-next-page" class="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded">&gt;</button>
           <button id="braden-add-page" class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 text-sm">+ เพิ่มชุดใหม่</button>
           <button id="close-braden-modal" class="bg-gray-500 text-white px-4 py-1 rounded hover:bg-gray-600 ml-2">ปิด</button>
        </div>
      </div>
      
      <div class="mt-4 bg-red-50 p-4 rounded border border-red-100 text-sm space-y-3 text-gray-700 font-sarabun">
          
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
              <div class="flex items-center gap-2">
                  <label class="font-bold whitespace-nowrap">วันที่ Admit:</label>
                  <input type="date" id="braden-admit-date" name="AdmitDate_Braden" class="border-b border-gray-400 bg-transparent w-full focus:outline-none text-center">
              </div>
              <div class="flex items-center gap-2">
                  <label class="font-bold whitespace-nowrap">วันที่รับย้าย:</label>
                  <input type="date" name="TransferDate" class="border-b border-gray-400 bg-transparent w-full focus:outline-none text-center">
              </div>
              <div class="flex items-center gap-2">
                  <label class="font-bold whitespace-nowrap">จาก Ward:</label>
                  <input type="text" name="FromWard" class="border-b border-gray-400 bg-transparent w-full focus:outline-none text-center">
              </div>
              <div class="flex items-center gap-2">
                  <label class="font-bold whitespace-nowrap">วันที่ประเมินครั้งแรก:</label>
                  <input type="date" name="FirstAssessDate" class="border-b border-gray-400 bg-transparent w-full focus:outline-none text-center">
              </div>
          </div>

          <div class="flex items-center gap-2">
              <label class="font-bold whitespace-nowrap">Diagnosis/Operation:</label>
              <input type="text" id="braden-dx" name="Dx_Op" class="border-b border-gray-400 bg-transparent w-full focus:outline-none">
          </div>

          <div class="flex flex-wrap items-center gap-4">
              <label class="font-bold">แผลกดทับแรกรับ:</label>
              <label class="flex items-center gap-1 cursor-pointer">
                  <input type="radio" name="PressureUlcer_Adm_Status" value="ไม่มี" class="accent-red-600"> ไม่มี
              </label>
              <label class="flex items-center gap-1 cursor-pointer">
                  <input type="radio" name="PressureUlcer_Adm_Status" value="มี" class="accent-red-600"> มี
              </label>
              <div class="flex items-center gap-2 flex-1">
                  <label class="whitespace-nowrap">ตำแหน่ง/ลักษณะ/ขนาด:</label>
                  <input type="text" name="PressureUlcer_Adm_Detail" class="border-b border-gray-400 bg-transparent w-full focus:outline-none">
              </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-4 gap-4 pt-2 border-t border-red-200">
              <div class="flex items-center gap-1">
                  <span class="font-bold">Serum Albumin</span>
                  <input type="text" id="braden-albumin" name="Albumin" class="border-b border-gray-400 bg-transparent w-12 text-center focus:outline-none">
                  <span class="text-xs text-gray-500">mg/dL (3.5-5.4)</span>
              </div>
              <div class="flex items-center gap-1">
                  <span class="font-bold">Hb =</span>
                  <input type="text" id="braden-hb" name="Hb" class="border-b border-gray-400 bg-transparent w-12 text-center focus:outline-none">
                  <span>mg%</span>
              </div>
              <div class="flex items-center gap-1">
                  <span class="font-bold">Hct =</span>
                  <input type="text" name="Hct" class="border-b border-gray-400 bg-transparent w-12 text-center focus:outline-none">
                  <span>Vol%</span>
              </div>
              <div class="flex items-center gap-1">
                  <span class="font-bold">BMI =</span>
                  <input type="text" id="braden-bmi" name="BMI" class="border-b border-gray-400 bg-transparent w-12 text-center focus:outline-none">
              </div>
          </div>

      </div>

  <div class="container mx-auto px-4 py-6 overflow-x-auto">
      <form id="braden-form">
          <table id="braden-table" class="w-full min-w-[1500px] border-collapse border border-gray-300 text-sm">
              </table>
          <div class="mt-4 flex justify-end">
             <button type="submit" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-8 rounded shadow-lg">
                บันทึกข้อมูล (Save)
             </button>
          </div>
      </form>
  </div>
</div>

  </main> <!-- (ย้าย </main> มาไว้ตรงนี้) -->

  <script src="script.js"></script>
</body>
</html>
